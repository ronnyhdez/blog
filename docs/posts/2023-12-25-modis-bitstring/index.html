<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Ronny A. Hernandez Mora">
<meta name="dcterms.date" content="2024-05-01">
<meta name="description" content="MODIS satellite images come with bit information regarding the quality of pixels. In this post, I’ll explore how to interpret these bits and categorize them for quality filtering using R.">

<title>Ronny A. Hernández Mora - MODIS pixel bit strings conversion with R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<link href="../../site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="../../site_libs/pagedtable-1.1/js/pagedtable.js"></script>


<meta property="og:title" content="Ronny A. Hernández Mora - MODIS pixel bit strings conversion with R">
<meta property="og:description" content="MODIS satellite images come with bit information regarding the quality of pixels. In this post, I’ll explore how to interpret these bits and categorize them for quality filtering using R.">
<meta property="og:image" content="https://ronnyale.com/posts/2023-12-25-modis-bitstring/images/nicoya.png">
<meta property="og:site-name" content="Ronny A. Hernández Mora">
<meta property="og:image:height" content="975">
<meta property="og:image:width" content="1643">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://ronnyale.com/" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Posts</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About this blog</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/ronnyhdez/blog" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/ronny_hdezmora" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://ronnyale.com/" rel="" target=""><i class="bi bi-person-circle" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">MODIS pixel bit strings conversion with R</h1>
                  <div>
        <div class="description">
          <p>MODIS satellite images come with bit information regarding the quality of pixels. In this post, I’ll explore how to interpret these bits and categorize them for quality filtering using R.</p>
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">MODIS</div>
                <div class="quarto-category">R</div>
                <div class="quarto-category">bits</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://ronnyale.com/">Ronny A. Hernandez Mora</a> <a href="https://orcid.org/0000-0001-6225-7096" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 1, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#what-are-we-going-to-do" id="toc-what-are-we-going-to-do" class="nav-link active" data-scroll-target="#what-are-we-going-to-do">What are we going to do?</a></li>
  <li><a href="#modis-and-the-bit-strings" id="toc-modis-and-the-bit-strings" class="nav-link" data-scroll-target="#modis-and-the-bit-strings">MODIS and the bit strings</a>
  <ul class="collapse">
  <li><a href="#variables-with-bit-strings" id="toc-variables-with-bit-strings" class="nav-link" data-scroll-target="#variables-with-bit-strings">Variables with bit strings</a></li>
  </ul></li>
  <li><a href="#using-bits-in-r" id="toc-using-bits-in-r" class="nav-link" data-scroll-target="#using-bits-in-r">Using bits in R</a></li>
  <li><a href="#binary-conversion" id="toc-binary-conversion" class="nav-link" data-scroll-target="#binary-conversion">Binary conversion</a>
  <ul class="collapse">
  <li><a href="#how-can-i-apply-the-idea-to-our-modis-data" id="toc-how-can-i-apply-the-idea-to-our-modis-data" class="nav-link" data-scroll-target="#how-can-i-apply-the-idea-to-our-modis-data">How can I apply the idea to our MODIS data?</a></li>
  <li><a href="#process-validation" id="toc-process-validation" class="nav-link" data-scroll-target="#process-validation">Process validation</a></li>
  <li><a href="#code-to-apply-the-bit-string-conversion-to-the-variables" id="toc-code-to-apply-the-bit-string-conversion-to-the-variables" class="nav-link" data-scroll-target="#code-to-apply-the-bit-string-conversion-to-the-variables">Code to apply the bit string conversion to the variables</a></li>
  </ul></li>
  <li><a href="#categories-for-each-of-the-bit-strings" id="toc-categories-for-each-of-the-bit-strings" class="nav-link" data-scroll-target="#categories-for-each-of-the-bit-strings">Categories for each of the bit strings</a>
  <ul class="collapse">
  <li><a href="#qc_500m-complete-bit-string-categories" id="toc-qc_500m-complete-bit-string-categories" class="nav-link" data-scroll-target="#qc_500m-complete-bit-string-categories"><code>qc_500m</code> complete bit string categories</a></li>
  <li><a href="#proof-of-concept-for-16-bits" id="toc-proof-of-concept-for-16-bits" class="nav-link" data-scroll-target="#proof-of-concept-for-16-bits">Proof of concept for 16 bits</a></li>
  </ul></li>
  <li><a href="#create-function-for-bit-string-conversion" id="toc-create-function-for-bit-string-conversion" class="nav-link" data-scroll-target="#create-function-for-bit-string-conversion">Create function for bit string conversion</a>
  <ul class="collapse">
  <li><a href="#q_scan" id="toc-q_scan" class="nav-link" data-scroll-target="#q_scan">q_scan</a></li>
  <li><a href="#g_flags" id="toc-g_flags" class="nav-link" data-scroll-target="#g_flags">g_flags</a></li>
  </ul></li>
  <li><a href="#conclusions-on-the-bit-conversion" id="toc-conclusions-on-the-bit-conversion" class="nav-link" data-scroll-target="#conclusions-on-the-bit-conversion">Conclusions on the bit conversion</a></li>
  <li><a href="#quality-filtering" id="toc-quality-filtering" class="nav-link" data-scroll-target="#quality-filtering">Quality filtering</a>
  <ul class="collapse">
  <li><a href="#select-bitmasks-categories-that-indicates-high-quality" id="toc-select-bitmasks-categories-that-indicates-high-quality" class="nav-link" data-scroll-target="#select-bitmasks-categories-that-indicates-high-quality">Select bitmasks categories that indicates high quality</a></li>
  <li><a href="#filter-from-complete-data-the-selected-bitmasks" id="toc-filter-from-complete-data-the-selected-bitmasks" class="nav-link" data-scroll-target="#filter-from-complete-data-the-selected-bitmasks">Filter from complete data the selected bitmasks</a></li>
  <li><a href="#some-plots-with-clean-reflectance_500-data" id="toc-some-plots-with-clean-reflectance_500-data" class="nav-link" data-scroll-target="#some-plots-with-clean-reflectance_500-data">Some plots with clean reflectance_500 data</a></li>
  </ul></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<section id="what-are-we-going-to-do" class="level1">
<h1>What are we going to do?</h1>
<p>So, I was working with some <a href="https://lpdaac.usgs.gov/products/mod09gav061/">MODIS Surfance Reflectance product images</a> from which I needed to calculate 4 vegetation indices to estimate Gross Primary Production. Apart from being careful with selecting images without snow or clouds I knew that every pixel comes with QA information useful to decide if including or not some of the pixels. Nonetheless, I was confused on how to perform such task on the many pixels that I had, and furthermore how to deal with the bits transformation into categories that I could understand and then filter in R according to their quality.</p>
<p>Luckily there are sources of documentation that I could go through to understand and get to work in my project. There was one <a href="https://stevemosher.wordpress.com/2012/12/05/modis-qc-bits/">blog post by Steve Mosher</a> from where I understood better what needed to be done. So I wrote down everything it worked for me and finally put it here.</p>
</section>
<section id="modis-and-the-bit-strings" class="level1">
<h1>MODIS and the bit strings</h1>
<p><!-- - Explain that each pixel will come with data about quality --> <!-- - Make reference to documentation --> <!-- - Explain QA in images --> <!--  Intro about what is MODIS, where to find the data, bands, metadata and the --> <!-- variables with the bits. --></p>
<p>The <a href="https://lpdaac.usgs.gov/documents/306/MOD09_User_Guide_V6.pdf">MODIS reference manual</a> …</p>
<section id="variables-with-bit-strings" class="level2">
<h2 class="anchored" data-anchor-id="variables-with-bit-strings">Variables with bit strings</h2>
<p><!-- - Mention variables with bitstrings --> <!-- - Explain what is the meaning of each of the variables --> <!-- - Explore (check unique values) the variables --></p>
<p>There are 4 variables in the dataset with a bitmask that needs to be converted:</p>
<ul>
<li><code>state_1km</code></li>
<li><code>gflags</code></li>
<li><code>qc_500m</code></li>
<li><code>q_scan</code></li>
</ul>
<p>According to the technical documentation, this variables contain information about ….</p>
<p>Let’s read the dataset to explore what do we have originally in here</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Data</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>reflectance_500 <span class="ot">&lt;-</span> </span>
<span id="cb1-3"><a href="#cb1-3"></a>  <span class="fu">readRDS</span>(<span class="fu">here</span>(<span class="st">"posts/2023-12-25-modis-bitstring/data/borden_modis_reflectance_500_clean.rds"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="how-many-unique-values-do-i-have-per-each-of-the-quality-variables" class="level4">
<h4 class="anchored" data-anchor-id="how-many-unique-values-do-i-have-per-each-of-the-quality-variables">How many unique values do I have per each of the quality variables?</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>reflectance_500 <span class="sc">|&gt;</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="fu">select</span>(state_1km, gflags, qc_500m, q_scan) <span class="sc">|&gt;</span> </span>
<span id="cb2-3"><a href="#cb2-3"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="sc">~</span><span class="fu">unique</span>(.))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$state_1km
 [1]  1033 40969  8392  1034 40970  5384  1289  1801 45068  1545  8397  8398
[13]  1032  8396  8393  5128 40973 40974 45064  8394 32781   206 36872 32778
[25] 32777  5640 36876 32776 45066  8334   200   138   136     8    72  8264
[37]  1544  8332  1802  1288  8328  1546  8268  8330  8205    76   204   141
[49]   140  8204 40972  8266   137  1290    74  1800 32780  5896 40968   205
[61]   202   201  8329  8270  5385  5898  5642

$gflags
[1] 0

$qc_500m
 [1] 1073741824 1073968181 1073954817 1075838976 1073968129 1073755137
 [7] 1073755189 1075852341 1076065281 1946383413 1073969013 1073954869
[13] 1075852289 1076065333 1076051969 1075576832 1075590145 1075803189

$q_scan
 [1] 14  8  9  2  0  6 15  3 13 11 12  1  7 10  5  4</code></pre>
</div>
</div>
<p>So, in our dataset, <code>state_1km</code> has 67 distinct values, <code>gflags</code> variable has 1 so we are not going to use this one, <code>qc_500m</code> has 18 distinct values, and <code>q_scan</code> variable has 16 unique values. We need to convert this integers into bits and then, make sense of those bits. This is going to be our first part of the exploration.</p>
</section>
</section>
</section>
<section id="using-bits-in-r" class="level1">
<h1>Using bits in R</h1>
<p><!-- - Explanation to understand how to perform the bit conversion in R --></p>
<p>So, how do we accomplish this in R? Fortunately, we have some functions in base R specifically designed to handle this type of information. In our case, the function <code>intToBits()</code> will be particularly helpful. For instance, let’s consider one of the values from the <code>q_scan</code> variable: the integer <code>14</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="fu">intToBits</span>(<span class="dv">14</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 00 01 01 01 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
[26] 00 00 00 00 00 00 00</code></pre>
</div>
</div>
<p>That’s quite a lengthy bit string! It contains more information than necessary. Therefore, we need to shorten this bit string and convert it into an integer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">as.integer</span>(<span class="fu">intToBits</span>(<span class="dv">14</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0 1 1 1 0 0 0 0</code></pre>
</div>
</div>
<ul>
<li>Remember that this has to be read from left to right. So the first bit is 0.</li>
<li>The 8 bits are numbered from 0 to 7 (as opposed to the R default).</li>
<li>Each bit represents a power of 2.</li>
<li>We need to reverse this bit string</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>bit_string <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">intToBits</span>(<span class="dv">14</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>])</span>
<span id="cb8-2"><a href="#cb8-2"></a>bit_string[<span class="dv">8</span><span class="sc">:</span><span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0 0 0 0 1 1 1 0</code></pre>
</div>
</div>
</section>
<section id="binary-conversion" class="level1">
<h1>Binary conversion</h1>
<p>Every pixel in the satellite images contains an integer value that must be converted to a bit binary value for interpretation. At first, it seems complicated but the documentation will help us here. For any sensor, we would need to check the documentation in order to perform any binary conversion and interpretation.</p>
<p>There is also a good video from the United States Geological Survey (USGS) that explains the process for the interpretation of the binary conversion with the documentation. From minute 2:34 of this <a href="https://www.usgs.gov/media/videos/getting-started-modis-v6-surface-reflectance-data-part-3">USGS video</a> it shows the process of the binary conversion.</p>
<section id="how-can-i-apply-the-idea-to-our-modis-data" class="level2">
<h2 class="anchored" data-anchor-id="how-can-i-apply-the-idea-to-our-modis-data">How can I apply the idea to our MODIS data?</h2>
<p>We’ve covered the basics of understanding bits, binary conversion, and interpretation. But how do we put this knowledge to use with our dataset? This is where <a href="https://stevemosher.wordpress.com/2012/12/05/modis-qc-bits/">Steve Mosher’s blog post</a> comes in handy.</p>
<p>Let’s start by taking a single value from the <code>qc_500m</code> variable in our dataset: <code>1075803189</code>. Here are the steps we’ll follow:</p>
<ul>
<li>Utilize the <code>intToBits()</code> function to obtain the binary representation.</li>
<li>Shorten the lengthy bit string to only include the necessary bits.</li>
<li>Reverse the order of the bits.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># Using one bitmask value from the dataset</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>bits <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">intToBits</span>(<span class="dv">1075803189</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">32</span>])</span>
<span id="cb10-3"><a href="#cb10-3"></a>bits</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1 0 1 0 1 1 0 0 0 0 1 0 1 1 1 0 1 1 1 1 1 0 0 0 0 0 0 0 0 0 1 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Reverse</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>bits[<span class="dv">32</span><span class="sc">:</span><span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0 1 0 0 0 0 0 0 0 0 0 1 1 1 1 1 0 1 1 1 0 1 0 0 0 0 1 1 0 1 0 1</code></pre>
</div>
</div>
<p>Ok! It looks like it works. But I’m not sure, so let’s do the same process but using the example from the USGS video.</p>
</section>
<section id="process-validation" class="level2">
<h2 class="anchored" data-anchor-id="process-validation">Process validation</h2>
<p>In the USGS video explanation, they show the binary conversion process with an example. I’m going to use the same integer value <code>1131675649</code> to validate if our code steps work as expected.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/usgs_example_int.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">USGS video integer example</figcaption>
</figure>
</div>
<p>The bit string obtained from the binary conversion should be:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/usgs_example_binary.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">USGS bit string example</figcaption>
</figure>
</div>
<p>That bit string should be matched with the categories assigned and described in the documentation:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/usgs_bit_conversion_video.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">USGS bit string quality categories</figcaption>
</figure>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co">#  Using the example value from video</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>binary_conversion <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">intToBits</span>(<span class="dv">1131675649</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">32</span>])</span>
<span id="cb14-3"><a href="#cb14-3"></a>bit_string <span class="ot">&lt;-</span> binary_conversion[<span class="dv">32</span><span class="sc">:</span><span class="dv">1</span>]</span>
<span id="cb14-4"><a href="#cb14-4"></a></span>
<span id="cb14-5"><a href="#cb14-5"></a><span class="co"># This one is the result of the binary transformation from the video</span></span>
<span id="cb14-6"><a href="#cb14-6"></a>validation <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>)</span>
<span id="cb14-7"><a href="#cb14-7"></a></span>
<span id="cb14-8"><a href="#cb14-8"></a><span class="co"># Check if object is the same as the one written by hand</span></span>
<span id="cb14-9"><a href="#cb14-9"></a><span class="fu">stopifnot</span>(bit_string <span class="sc">==</span> validation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The steps does match the final result. Next, I need to apply the same logical conditions to my data.</p>
</section>
<section id="code-to-apply-the-bit-string-conversion-to-the-variables" class="level2">
<h2 class="anchored" data-anchor-id="code-to-apply-the-bit-string-conversion-to-the-variables">Code to apply the bit string conversion to the variables</h2>
<p>Now that I know which steps are needed to do the conversion, I need to develop the code further to apply it to each of the variables with a bit mask. On this first try, I will do it with the variable <code>qc_500m</code>.</p>
<p>For this variable, I’m going to create a dataset with the variable <code>qc_ints</code> that contains the 18 unique integer values from the <code>qc_500m</code> variable plus one more observation from USGS video example to use it as a test validation. Then I’m going to add 32 more variables for each of the bits that we will obtain from the binary conversion process.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="do">## Create column with unique values and add one validation (from the video)</span></span>
<span id="cb15-2"><a href="#cb15-2"></a>qc_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">qc_ints =</span> <span class="fu">c</span>(<span class="fu">unique</span>(reflectance_500<span class="sc">$</span>qc_500m), <span class="dv">1131675649</span>))</span>
<span id="cb15-3"><a href="#cb15-3"></a></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="do">## Create empty data frame. This case is 32 given that the variable</span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="do">## `qc_500m` have 32 bits</span></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">31</span><span class="sc">:</span><span class="dv">0</span>)) {</span>
<span id="cb15-7"><a href="#cb15-7"></a>  qc_data[, <span class="fu">paste0</span>(<span class="st">"bit_"</span>, i)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb15-8"><a href="#cb15-8"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here is how the data frame looks like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="fu">paged_table</span>(qc_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["qc_ints"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["bit_31"],"name":[2],"type":["lgl"],"align":["right"]},{"label":["bit_30"],"name":[3],"type":["lgl"],"align":["right"]},{"label":["bit_29"],"name":[4],"type":["lgl"],"align":["right"]},{"label":["bit_28"],"name":[5],"type":["lgl"],"align":["right"]},{"label":["bit_27"],"name":[6],"type":["lgl"],"align":["right"]},{"label":["bit_26"],"name":[7],"type":["lgl"],"align":["right"]},{"label":["bit_25"],"name":[8],"type":["lgl"],"align":["right"]},{"label":["bit_24"],"name":[9],"type":["lgl"],"align":["right"]},{"label":["bit_23"],"name":[10],"type":["lgl"],"align":["right"]},{"label":["bit_22"],"name":[11],"type":["lgl"],"align":["right"]},{"label":["bit_21"],"name":[12],"type":["lgl"],"align":["right"]},{"label":["bit_20"],"name":[13],"type":["lgl"],"align":["right"]},{"label":["bit_19"],"name":[14],"type":["lgl"],"align":["right"]},{"label":["bit_18"],"name":[15],"type":["lgl"],"align":["right"]},{"label":["bit_17"],"name":[16],"type":["lgl"],"align":["right"]},{"label":["bit_16"],"name":[17],"type":["lgl"],"align":["right"]},{"label":["bit_15"],"name":[18],"type":["lgl"],"align":["right"]},{"label":["bit_14"],"name":[19],"type":["lgl"],"align":["right"]},{"label":["bit_13"],"name":[20],"type":["lgl"],"align":["right"]},{"label":["bit_12"],"name":[21],"type":["lgl"],"align":["right"]},{"label":["bit_11"],"name":[22],"type":["lgl"],"align":["right"]},{"label":["bit_10"],"name":[23],"type":["lgl"],"align":["right"]},{"label":["bit_9"],"name":[24],"type":["lgl"],"align":["right"]},{"label":["bit_8"],"name":[25],"type":["lgl"],"align":["right"]},{"label":["bit_7"],"name":[26],"type":["lgl"],"align":["right"]},{"label":["bit_6"],"name":[27],"type":["lgl"],"align":["right"]},{"label":["bit_5"],"name":[28],"type":["lgl"],"align":["right"]},{"label":["bit_4"],"name":[29],"type":["lgl"],"align":["right"]},{"label":["bit_3"],"name":[30],"type":["lgl"],"align":["right"]},{"label":["bit_2"],"name":[31],"type":["lgl"],"align":["right"]},{"label":["bit_1"],"name":[32],"type":["lgl"],"align":["right"]},{"label":["bit_0"],"name":[33],"type":["lgl"],"align":["right"]}],"data":[{"1":"1073741824","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"NA","10":"NA","11":"NA","12":"NA","13":"NA","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"NA","23":"NA","24":"NA","25":"NA","26":"NA","27":"NA","28":"NA","29":"NA","30":"NA","31":"NA","32":"NA","33":"NA"},{"1":"1073968181","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"NA","10":"NA","11":"NA","12":"NA","13":"NA","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"NA","23":"NA","24":"NA","25":"NA","26":"NA","27":"NA","28":"NA","29":"NA","30":"NA","31":"NA","32":"NA","33":"NA"},{"1":"1073954817","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"NA","10":"NA","11":"NA","12":"NA","13":"NA","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"NA","23":"NA","24":"NA","25":"NA","26":"NA","27":"NA","28":"NA","29":"NA","30":"NA","31":"NA","32":"NA","33":"NA"},{"1":"1075838976","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"NA","10":"NA","11":"NA","12":"NA","13":"NA","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"NA","23":"NA","24":"NA","25":"NA","26":"NA","27":"NA","28":"NA","29":"NA","30":"NA","31":"NA","32":"NA","33":"NA"},{"1":"1073968129","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"NA","10":"NA","11":"NA","12":"NA","13":"NA","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"NA","23":"NA","24":"NA","25":"NA","26":"NA","27":"NA","28":"NA","29":"NA","30":"NA","31":"NA","32":"NA","33":"NA"},{"1":"1073755137","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"NA","10":"NA","11":"NA","12":"NA","13":"NA","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"NA","23":"NA","24":"NA","25":"NA","26":"NA","27":"NA","28":"NA","29":"NA","30":"NA","31":"NA","32":"NA","33":"NA"},{"1":"1073755189","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"NA","10":"NA","11":"NA","12":"NA","13":"NA","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"NA","23":"NA","24":"NA","25":"NA","26":"NA","27":"NA","28":"NA","29":"NA","30":"NA","31":"NA","32":"NA","33":"NA"},{"1":"1075852341","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"NA","10":"NA","11":"NA","12":"NA","13":"NA","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"NA","23":"NA","24":"NA","25":"NA","26":"NA","27":"NA","28":"NA","29":"NA","30":"NA","31":"NA","32":"NA","33":"NA"},{"1":"1076065281","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"NA","10":"NA","11":"NA","12":"NA","13":"NA","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"NA","23":"NA","24":"NA","25":"NA","26":"NA","27":"NA","28":"NA","29":"NA","30":"NA","31":"NA","32":"NA","33":"NA"},{"1":"1946383413","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"NA","10":"NA","11":"NA","12":"NA","13":"NA","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"NA","23":"NA","24":"NA","25":"NA","26":"NA","27":"NA","28":"NA","29":"NA","30":"NA","31":"NA","32":"NA","33":"NA"},{"1":"1073969013","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"NA","10":"NA","11":"NA","12":"NA","13":"NA","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"NA","23":"NA","24":"NA","25":"NA","26":"NA","27":"NA","28":"NA","29":"NA","30":"NA","31":"NA","32":"NA","33":"NA"},{"1":"1073954869","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"NA","10":"NA","11":"NA","12":"NA","13":"NA","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"NA","23":"NA","24":"NA","25":"NA","26":"NA","27":"NA","28":"NA","29":"NA","30":"NA","31":"NA","32":"NA","33":"NA"},{"1":"1075852289","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"NA","10":"NA","11":"NA","12":"NA","13":"NA","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"NA","23":"NA","24":"NA","25":"NA","26":"NA","27":"NA","28":"NA","29":"NA","30":"NA","31":"NA","32":"NA","33":"NA"},{"1":"1076065333","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"NA","10":"NA","11":"NA","12":"NA","13":"NA","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"NA","23":"NA","24":"NA","25":"NA","26":"NA","27":"NA","28":"NA","29":"NA","30":"NA","31":"NA","32":"NA","33":"NA"},{"1":"1076051969","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"NA","10":"NA","11":"NA","12":"NA","13":"NA","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"NA","23":"NA","24":"NA","25":"NA","26":"NA","27":"NA","28":"NA","29":"NA","30":"NA","31":"NA","32":"NA","33":"NA"},{"1":"1075576832","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"NA","10":"NA","11":"NA","12":"NA","13":"NA","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"NA","23":"NA","24":"NA","25":"NA","26":"NA","27":"NA","28":"NA","29":"NA","30":"NA","31":"NA","32":"NA","33":"NA"},{"1":"1075590145","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"NA","10":"NA","11":"NA","12":"NA","13":"NA","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"NA","23":"NA","24":"NA","25":"NA","26":"NA","27":"NA","28":"NA","29":"NA","30":"NA","31":"NA","32":"NA","33":"NA"},{"1":"1075803189","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"NA","10":"NA","11":"NA","12":"NA","13":"NA","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"NA","23":"NA","24":"NA","25":"NA","26":"NA","27":"NA","28":"NA","29":"NA","30":"NA","31":"NA","32":"NA","33":"NA"},{"1":"1131675649","2":"NA","3":"NA","4":"NA","5":"NA","6":"NA","7":"NA","8":"NA","9":"NA","10":"NA","11":"NA","12":"NA","13":"NA","14":"NA","15":"NA","16":"NA","17":"NA","18":"NA","19":"NA","20":"NA","21":"NA","22":"NA","23":"NA","24":"NA","25":"NA","26":"NA","27":"NA","28":"NA","29":"NA","30":"NA","31":"NA","32":"NA","33":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>So far, we have a dataframe with 33 variables (one with the original integers values and 32 more to fill with the bit strings) and 19 observations. Now I can loop through each of the bits variables filling them with the values from the binary conversion result from the original integers</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># Loop for obtaining bit string from unique values in the variable</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>z <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="cf">for</span> (i <span class="cf">in</span> qc_data<span class="sc">$</span>qc_ints) {</span>
<span id="cb17-4"><a href="#cb17-4"></a>  <span class="co"># print(i)</span></span>
<span id="cb17-5"><a href="#cb17-5"></a>  transformed <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">intToBits</span>(i)[<span class="dv">1</span><span class="sc">:</span><span class="dv">32</span>])</span>
<span id="cb17-6"><a href="#cb17-6"></a>  qc_data[z, <span class="dv">2</span><span class="sc">:</span><span class="dv">33</span>] <span class="ot">&lt;-</span> transformed[<span class="dv">32</span><span class="sc">:</span><span class="dv">1</span>]</span>
<span id="cb17-7"><a href="#cb17-7"></a>  z <span class="ot">&lt;-</span> z <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb17-8"><a href="#cb17-8"></a>}</span>
<span id="cb17-9"><a href="#cb17-9"></a></span>
<span id="cb17-10"><a href="#cb17-10"></a><span class="co"># Check the data frame</span></span>
<span id="cb17-11"><a href="#cb17-11"></a><span class="fu">paged_table</span>(qc_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["qc_ints"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["bit_31"],"name":[2],"type":["int"],"align":["right"]},{"label":["bit_30"],"name":[3],"type":["int"],"align":["right"]},{"label":["bit_29"],"name":[4],"type":["int"],"align":["right"]},{"label":["bit_28"],"name":[5],"type":["int"],"align":["right"]},{"label":["bit_27"],"name":[6],"type":["int"],"align":["right"]},{"label":["bit_26"],"name":[7],"type":["int"],"align":["right"]},{"label":["bit_25"],"name":[8],"type":["int"],"align":["right"]},{"label":["bit_24"],"name":[9],"type":["int"],"align":["right"]},{"label":["bit_23"],"name":[10],"type":["int"],"align":["right"]},{"label":["bit_22"],"name":[11],"type":["int"],"align":["right"]},{"label":["bit_21"],"name":[12],"type":["int"],"align":["right"]},{"label":["bit_20"],"name":[13],"type":["int"],"align":["right"]},{"label":["bit_19"],"name":[14],"type":["int"],"align":["right"]},{"label":["bit_18"],"name":[15],"type":["int"],"align":["right"]},{"label":["bit_17"],"name":[16],"type":["int"],"align":["right"]},{"label":["bit_16"],"name":[17],"type":["int"],"align":["right"]},{"label":["bit_15"],"name":[18],"type":["int"],"align":["right"]},{"label":["bit_14"],"name":[19],"type":["int"],"align":["right"]},{"label":["bit_13"],"name":[20],"type":["int"],"align":["right"]},{"label":["bit_12"],"name":[21],"type":["int"],"align":["right"]},{"label":["bit_11"],"name":[22],"type":["int"],"align":["right"]},{"label":["bit_10"],"name":[23],"type":["int"],"align":["right"]},{"label":["bit_9"],"name":[24],"type":["int"],"align":["right"]},{"label":["bit_8"],"name":[25],"type":["int"],"align":["right"]},{"label":["bit_7"],"name":[26],"type":["int"],"align":["right"]},{"label":["bit_6"],"name":[27],"type":["int"],"align":["right"]},{"label":["bit_5"],"name":[28],"type":["int"],"align":["right"]},{"label":["bit_4"],"name":[29],"type":["int"],"align":["right"]},{"label":["bit_3"],"name":[30],"type":["int"],"align":["right"]},{"label":["bit_2"],"name":[31],"type":["int"],"align":["right"]},{"label":["bit_1"],"name":[32],"type":["int"],"align":["right"]},{"label":["bit_0"],"name":[33],"type":["int"],"align":["right"]}],"data":[{"1":"1073741824","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"0","15":"0","16":"0","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0","32":"0","33":"0"},{"1":"1073968181","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"0","15":"0","16":"1","17":"1","18":"0","19":"1","20":"1","21":"1","22":"0","23":"1","24":"0","25":"0","26":"0","27":"0","28":"1","29":"1","30":"0","31":"1","32":"0","33":"1"},{"1":"1073954817","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"0","15":"0","16":"1","17":"1","18":"0","19":"1","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0","32":"0","33":"1"},{"1":"1075838976","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"1","13":"0","14":"0","15":"0","16":"0","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0","32":"0","33":"0"},{"1":"1073968129","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"0","15":"0","16":"1","17":"1","18":"0","19":"1","20":"1","21":"1","22":"0","23":"1","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0","32":"0","33":"1"},{"1":"1073755137","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"0","15":"0","16":"0","17":"0","18":"0","19":"0","20":"1","21":"1","22":"0","23":"1","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0","32":"0","33":"1"},{"1":"1073755189","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"0","15":"0","16":"0","17":"0","18":"0","19":"0","20":"1","21":"1","22":"0","23":"1","24":"0","25":"0","26":"0","27":"0","28":"1","29":"1","30":"0","31":"1","32":"0","33":"1"},{"1":"1075852341","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"1","13":"0","14":"0","15":"0","16":"0","17":"0","18":"0","19":"0","20":"1","21":"1","22":"0","23":"1","24":"0","25":"0","26":"0","27":"0","28":"1","29":"1","30":"0","31":"1","32":"0","33":"1"},{"1":"1076065281","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"1","13":"0","14":"0","15":"0","16":"1","17":"1","18":"0","19":"1","20":"1","21":"1","22":"0","23":"1","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0","32":"0","33":"1"},{"1":"1946383413","2":"0","3":"1","4":"1","5":"1","6":"0","7":"1","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"0","15":"0","16":"1","17":"1","18":"0","19":"1","20":"1","21":"1","22":"0","23":"1","24":"0","25":"0","26":"0","27":"0","28":"1","29":"1","30":"0","31":"1","32":"0","33":"1"},{"1":"1073969013","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"0","15":"0","16":"1","17":"1","18":"0","19":"1","20":"1","21":"1","22":"0","23":"1","24":"1","25":"1","26":"0","27":"1","28":"1","29":"1","30":"0","31":"1","32":"0","33":"1"},{"1":"1073954869","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"0","15":"0","16":"1","17":"1","18":"0","19":"1","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"1","29":"1","30":"0","31":"1","32":"0","33":"1"},{"1":"1075852289","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"1","13":"0","14":"0","15":"0","16":"0","17":"0","18":"0","19":"0","20":"1","21":"1","22":"0","23":"1","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0","32":"0","33":"1"},{"1":"1076065333","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"1","13":"0","14":"0","15":"0","16":"1","17":"1","18":"0","19":"1","20":"1","21":"1","22":"0","23":"1","24":"0","25":"0","26":"0","27":"0","28":"1","29":"1","30":"0","31":"1","32":"0","33":"1"},{"1":"1076051969","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"1","13":"0","14":"0","15":"0","16":"1","17":"1","18":"0","19":"1","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0","32":"0","33":"1"},{"1":"1075576832","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"1","14":"1","15":"1","16":"0","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0","32":"0","33":"0"},{"1":"1075590145","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"1","14":"1","15":"1","16":"0","17":"0","18":"0","19":"0","20":"1","21":"1","22":"0","23":"1","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0","32":"0","33":"1"},{"1":"1075803189","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"1","14":"1","15":"1","16":"1","17":"1","18":"0","19":"1","20":"1","21":"1","22":"0","23":"1","24":"0","25":"0","26":"0","27":"0","28":"1","29":"1","30":"0","31":"1","32":"0","33":"1"},{"1":"1131675649","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"1","9":"1","10":"0","11":"1","12":"1","13":"1","14":"0","15":"1","16":"0","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0","32":"0","33":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Every bit variable is filled with <code>0's</code> or <code>1's</code>. Looks good, but I want to validate with the USGS example observation we added at the beginning if I’m obtaining the correct bit strings:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="do">## Create test according to value in video</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>process_test <span class="ot">&lt;-</span> qc_data <span class="sc">|&gt;</span> </span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="fu">filter</span>(qc_ints <span class="sc">==</span> <span class="dv">1131675649</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-4"><a href="#cb18-4"></a>  <span class="fu">select</span>(<span class="sc">-</span>qc_ints) <span class="sc">|&gt;</span></span>
<span id="cb18-5"><a href="#cb18-5"></a>  <span class="fu">unite</span>(<span class="at">col =</span> <span class="st">"new"</span>, bit_31<span class="sc">:</span>bit_0, <span class="at">sep =</span> <span class="st">""</span>) <span class="sc">|&gt;</span> </span>
<span id="cb18-6"><a href="#cb18-6"></a>  <span class="fu">pull</span>() </span>
<span id="cb18-7"><a href="#cb18-7"></a></span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="fu">stopifnot</span>(process_test <span class="sc">==</span> <span class="st">"01000011011101000000000000000001"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we know that the code is working and we can perform the binary conversion successfully, we can continue with the matching of categorization of the quality according to the documentation.</p>
</section>
</section>
<section id="categories-for-each-of-the-bit-strings" class="level1">
<h1>Categories for each of the bit strings</h1>
<p>Continuing with the variable <code>qc_500m</code> from which I have already the bit strings, I can follow the <a href="https://lpdaac.usgs.gov/documents/306/MOD09_User_Guide_V6.pdf">MODIS documentation</a> to add the categories for each combination of bits.</p>
<p>This steps can be done in <strong>two</strong> different (but similar) ways: using conditionals for each of the bits, or joining the variables with the specific bits.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">paged_table</span>(qc_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["qc_ints"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["bit_31"],"name":[2],"type":["int"],"align":["right"]},{"label":["bit_30"],"name":[3],"type":["int"],"align":["right"]},{"label":["bit_29"],"name":[4],"type":["int"],"align":["right"]},{"label":["bit_28"],"name":[5],"type":["int"],"align":["right"]},{"label":["bit_27"],"name":[6],"type":["int"],"align":["right"]},{"label":["bit_26"],"name":[7],"type":["int"],"align":["right"]},{"label":["bit_25"],"name":[8],"type":["int"],"align":["right"]},{"label":["bit_24"],"name":[9],"type":["int"],"align":["right"]},{"label":["bit_23"],"name":[10],"type":["int"],"align":["right"]},{"label":["bit_22"],"name":[11],"type":["int"],"align":["right"]},{"label":["bit_21"],"name":[12],"type":["int"],"align":["right"]},{"label":["bit_20"],"name":[13],"type":["int"],"align":["right"]},{"label":["bit_19"],"name":[14],"type":["int"],"align":["right"]},{"label":["bit_18"],"name":[15],"type":["int"],"align":["right"]},{"label":["bit_17"],"name":[16],"type":["int"],"align":["right"]},{"label":["bit_16"],"name":[17],"type":["int"],"align":["right"]},{"label":["bit_15"],"name":[18],"type":["int"],"align":["right"]},{"label":["bit_14"],"name":[19],"type":["int"],"align":["right"]},{"label":["bit_13"],"name":[20],"type":["int"],"align":["right"]},{"label":["bit_12"],"name":[21],"type":["int"],"align":["right"]},{"label":["bit_11"],"name":[22],"type":["int"],"align":["right"]},{"label":["bit_10"],"name":[23],"type":["int"],"align":["right"]},{"label":["bit_9"],"name":[24],"type":["int"],"align":["right"]},{"label":["bit_8"],"name":[25],"type":["int"],"align":["right"]},{"label":["bit_7"],"name":[26],"type":["int"],"align":["right"]},{"label":["bit_6"],"name":[27],"type":["int"],"align":["right"]},{"label":["bit_5"],"name":[28],"type":["int"],"align":["right"]},{"label":["bit_4"],"name":[29],"type":["int"],"align":["right"]},{"label":["bit_3"],"name":[30],"type":["int"],"align":["right"]},{"label":["bit_2"],"name":[31],"type":["int"],"align":["right"]},{"label":["bit_1"],"name":[32],"type":["int"],"align":["right"]},{"label":["bit_0"],"name":[33],"type":["int"],"align":["right"]}],"data":[{"1":"1073741824","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"0","15":"0","16":"0","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0","32":"0","33":"0"},{"1":"1073968181","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"0","15":"0","16":"1","17":"1","18":"0","19":"1","20":"1","21":"1","22":"0","23":"1","24":"0","25":"0","26":"0","27":"0","28":"1","29":"1","30":"0","31":"1","32":"0","33":"1"},{"1":"1073954817","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"0","15":"0","16":"1","17":"1","18":"0","19":"1","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0","32":"0","33":"1"},{"1":"1075838976","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"1","13":"0","14":"0","15":"0","16":"0","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0","32":"0","33":"0"},{"1":"1073968129","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"0","15":"0","16":"1","17":"1","18":"0","19":"1","20":"1","21":"1","22":"0","23":"1","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0","32":"0","33":"1"},{"1":"1073755137","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"0","15":"0","16":"0","17":"0","18":"0","19":"0","20":"1","21":"1","22":"0","23":"1","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0","32":"0","33":"1"},{"1":"1073755189","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"0","15":"0","16":"0","17":"0","18":"0","19":"0","20":"1","21":"1","22":"0","23":"1","24":"0","25":"0","26":"0","27":"0","28":"1","29":"1","30":"0","31":"1","32":"0","33":"1"},{"1":"1075852341","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"1","13":"0","14":"0","15":"0","16":"0","17":"0","18":"0","19":"0","20":"1","21":"1","22":"0","23":"1","24":"0","25":"0","26":"0","27":"0","28":"1","29":"1","30":"0","31":"1","32":"0","33":"1"},{"1":"1076065281","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"1","13":"0","14":"0","15":"0","16":"1","17":"1","18":"0","19":"1","20":"1","21":"1","22":"0","23":"1","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0","32":"0","33":"1"},{"1":"1946383413","2":"0","3":"1","4":"1","5":"1","6":"0","7":"1","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"0","15":"0","16":"1","17":"1","18":"0","19":"1","20":"1","21":"1","22":"0","23":"1","24":"0","25":"0","26":"0","27":"0","28":"1","29":"1","30":"0","31":"1","32":"0","33":"1"},{"1":"1073969013","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"0","15":"0","16":"1","17":"1","18":"0","19":"1","20":"1","21":"1","22":"0","23":"1","24":"1","25":"1","26":"0","27":"1","28":"1","29":"1","30":"0","31":"1","32":"0","33":"1"},{"1":"1073954869","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"0","15":"0","16":"1","17":"1","18":"0","19":"1","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"1","29":"1","30":"0","31":"1","32":"0","33":"1"},{"1":"1075852289","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"1","13":"0","14":"0","15":"0","16":"0","17":"0","18":"0","19":"0","20":"1","21":"1","22":"0","23":"1","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0","32":"0","33":"1"},{"1":"1076065333","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"1","13":"0","14":"0","15":"0","16":"1","17":"1","18":"0","19":"1","20":"1","21":"1","22":"0","23":"1","24":"0","25":"0","26":"0","27":"0","28":"1","29":"1","30":"0","31":"1","32":"0","33":"1"},{"1":"1076051969","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"1","13":"0","14":"0","15":"0","16":"1","17":"1","18":"0","19":"1","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0","32":"0","33":"1"},{"1":"1075576832","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"1","14":"1","15":"1","16":"0","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0","32":"0","33":"0"},{"1":"1075590145","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"1","14":"1","15":"1","16":"0","17":"0","18":"0","19":"0","20":"1","21":"1","22":"0","23":"1","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0","32":"0","33":"1"},{"1":"1075803189","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"1","14":"1","15":"1","16":"1","17":"1","18":"0","19":"1","20":"1","21":"1","22":"0","23":"1","24":"0","25":"0","26":"0","27":"0","28":"1","29":"1","30":"0","31":"1","32":"0","33":"1"},{"1":"1131675649","2":"0","3":"1","4":"0","5":"0","6":"0","7":"0","8":"1","9":"1","10":"0","11":"1","12":"1","13":"1","14":"0","15":"1","16":"0","17":"0","18":"0","19":"0","20":"0","21":"0","22":"0","23":"0","24":"0","25":"0","26":"0","27":"0","28":"0","29":"0","30":"0","31":"0","32":"0","33":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><strong>First possible solution</strong></p>
<p>This one will take the bits separately and use the boolean <code>&amp;</code> to categorize the information contained in the bit string:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a>qc_data <span class="sc">|&gt;</span> </span>
<span id="cb20-2"><a href="#cb20-2"></a>  <span class="fu">mutate</span>(<span class="at">modland_qa =</span> <span class="fu">case_when</span>(</span>
<span id="cb20-3"><a href="#cb20-3"></a>    bit_1 <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> bit_0 <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"ideal quality - all bands"</span>,</span>
<span id="cb20-4"><a href="#cb20-4"></a>    bit_1 <span class="sc">==</span> <span class="dv">0</span> <span class="sc">&amp;</span> bit_0 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"less than ideal quality - some or all bands"</span>,</span>
<span id="cb20-5"><a href="#cb20-5"></a>    bit_1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> bit_0 <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"product not produced due to cloud effects"</span>,</span>
<span id="cb20-6"><a href="#cb20-6"></a>    bit_1 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">&amp;</span> bit_0 <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"product not produced for other reasons"</span>,</span>
<span id="cb20-7"><a href="#cb20-7"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"No info, please validate bit conversion"</span></span>
<span id="cb20-8"><a href="#cb20-8"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb20-9"><a href="#cb20-9"></a>  <span class="fu">select</span>(qc_ints, bit_1, bit_0, modland_qa) <span class="sc">|&gt;</span> </span>
<span id="cb20-10"><a href="#cb20-10"></a>  <span class="fu">paged_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["qc_ints"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["bit_1"],"name":[2],"type":["int"],"align":["right"]},{"label":["bit_0"],"name":[3],"type":["int"],"align":["right"]},{"label":["modland_qa"],"name":[4],"type":["chr"],"align":["left"]}],"data":[{"1":"1073741824","2":"0","3":"0","4":"ideal quality - all bands"},{"1":"1073968181","2":"0","3":"1","4":"less than ideal quality - some or all bands"},{"1":"1073954817","2":"0","3":"1","4":"less than ideal quality - some or all bands"},{"1":"1075838976","2":"0","3":"0","4":"ideal quality - all bands"},{"1":"1073968129","2":"0","3":"1","4":"less than ideal quality - some or all bands"},{"1":"1073755137","2":"0","3":"1","4":"less than ideal quality - some or all bands"},{"1":"1073755189","2":"0","3":"1","4":"less than ideal quality - some or all bands"},{"1":"1075852341","2":"0","3":"1","4":"less than ideal quality - some or all bands"},{"1":"1076065281","2":"0","3":"1","4":"less than ideal quality - some or all bands"},{"1":"1946383413","2":"0","3":"1","4":"less than ideal quality - some or all bands"},{"1":"1073969013","2":"0","3":"1","4":"less than ideal quality - some or all bands"},{"1":"1073954869","2":"0","3":"1","4":"less than ideal quality - some or all bands"},{"1":"1075852289","2":"0","3":"1","4":"less than ideal quality - some or all bands"},{"1":"1076065333","2":"0","3":"1","4":"less than ideal quality - some or all bands"},{"1":"1076051969","2":"0","3":"1","4":"less than ideal quality - some or all bands"},{"1":"1075576832","2":"0","3":"0","4":"ideal quality - all bands"},{"1":"1075590145","2":"0","3":"1","4":"less than ideal quality - some or all bands"},{"1":"1075803189","2":"0","3":"1","4":"less than ideal quality - some or all bands"},{"1":"1131675649","2":"0","3":"1","4":"less than ideal quality - some or all bands"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><strong>Second possible solution</strong></p>
<p>For this one, I will join the bits and then categorize each one accordingly:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a><span class="co"># Second possible solution</span></span>
<span id="cb21-2"><a href="#cb21-2"></a>qc_data <span class="sc">|&gt;</span> </span>
<span id="cb21-3"><a href="#cb21-3"></a>  <span class="fu">unite</span>(<span class="at">col =</span> <span class="st">"modland"</span>, <span class="fu">c</span>(<span class="st">"bit_1"</span>, <span class="st">"bit_0"</span>), <span class="at">sep =</span> <span class="st">""</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-4"><a href="#cb21-4"></a>  <span class="fu">mutate</span>(<span class="at">modland_qa =</span> <span class="fu">case_when</span>(</span>
<span id="cb21-5"><a href="#cb21-5"></a>    modland <span class="sc">==</span> <span class="st">"00"</span> <span class="sc">~</span> <span class="st">"ideal quality - all bands"</span>,</span>
<span id="cb21-6"><a href="#cb21-6"></a>    modland <span class="sc">==</span> <span class="st">"01"</span> <span class="sc">~</span> <span class="st">"less than ideal quality - some or all bands"</span>,</span>
<span id="cb21-7"><a href="#cb21-7"></a>    modland <span class="sc">==</span> <span class="st">"10"</span> <span class="sc">~</span> <span class="st">"product not produced due to cloud effects"</span>,</span>
<span id="cb21-8"><a href="#cb21-8"></a>    modland <span class="sc">==</span> <span class="st">"11"</span> <span class="sc">~</span> <span class="st">"product not produced for other reasons"</span>,</span>
<span id="cb21-9"><a href="#cb21-9"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"No info, please validate bit conversion"</span></span>
<span id="cb21-10"><a href="#cb21-10"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb21-11"><a href="#cb21-11"></a>  <span class="fu">select</span>(qc_ints, modland, modland_qa) <span class="sc">|&gt;</span> </span>
<span id="cb21-12"><a href="#cb21-12"></a>  <span class="fu">paged_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["qc_ints"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["modland"],"name":[2],"type":["chr"],"align":["left"]},{"label":["modland_qa"],"name":[3],"type":["chr"],"align":["left"]}],"data":[{"1":"1073741824","2":"00","3":"ideal quality - all bands"},{"1":"1073968181","2":"01","3":"less than ideal quality - some or all bands"},{"1":"1073954817","2":"01","3":"less than ideal quality - some or all bands"},{"1":"1075838976","2":"00","3":"ideal quality - all bands"},{"1":"1073968129","2":"01","3":"less than ideal quality - some or all bands"},{"1":"1073755137","2":"01","3":"less than ideal quality - some or all bands"},{"1":"1073755189","2":"01","3":"less than ideal quality - some or all bands"},{"1":"1075852341","2":"01","3":"less than ideal quality - some or all bands"},{"1":"1076065281","2":"01","3":"less than ideal quality - some or all bands"},{"1":"1946383413","2":"01","3":"less than ideal quality - some or all bands"},{"1":"1073969013","2":"01","3":"less than ideal quality - some or all bands"},{"1":"1073954869","2":"01","3":"less than ideal quality - some or all bands"},{"1":"1075852289","2":"01","3":"less than ideal quality - some or all bands"},{"1":"1076065333","2":"01","3":"less than ideal quality - some or all bands"},{"1":"1076051969","2":"01","3":"less than ideal quality - some or all bands"},{"1":"1075576832","2":"00","3":"ideal quality - all bands"},{"1":"1075590145","2":"01","3":"less than ideal quality - some or all bands"},{"1":"1075803189","2":"01","3":"less than ideal quality - some or all bands"},{"1":"1131675649","2":"01","3":"less than ideal quality - some or all bands"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>Considering that I’ll need to write out each condition to categorize them according to the documentation, I believe it would be more manageable and readable to follow the second solution. For each series of bits, I’ll merge them as a single column and categorize them.</p>
<section id="qc_500m-complete-bit-string-categories" class="level2">
<h2 class="anchored" data-anchor-id="qc_500m-complete-bit-string-categories"><code>qc_500m</code> complete bit string categories</h2>
<p>The following code chunk encompasses all the necessary steps to incorporate all the categories specified in the MODIS documentation. Initially, it involves merging the required bits into columns and then generating the categorization as described in the documentation. The outcome of this process will be a data frame containing the categories for the original integer values within our variable</p>
<p>From the documentation, we have which bit strings should be considered together to classify the values into categories. Based on those bit positions, we are going to unite the columns to obtain the bit combination. For example, for the <code>Parameter Name</code> MODLAND QA bits, we have to take the bit in position 0 and the bit position 1, which can have 4 different combinations: <code>00</code>, <code>01</code>, <code>10</code>, and <code>11</code>. Each of those 4 combinations will be categorized into their respective categories.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/qc_bit_order.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Coarse Resolution Surface Reflectance Band Quality Description</figcaption>
</figure>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>qc_500_description <span class="ot">&lt;-</span> qc_data <span class="sc">|&gt;</span> </span>
<span id="cb22-2"><a href="#cb22-2"></a>  <span class="fu">unite</span>(<span class="at">col =</span> <span class="st">"modland"</span>, <span class="fu">c</span>(<span class="st">"bit_1"</span>, <span class="st">"bit_0"</span>), <span class="at">sep =</span> <span class="st">""</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-3"><a href="#cb22-3"></a>  <span class="fu">unite</span>(<span class="at">col =</span> <span class="st">"band_1"</span>, </span>
<span id="cb22-4"><a href="#cb22-4"></a>        <span class="fu">c</span>(<span class="st">"bit_5"</span>, <span class="st">"bit_4"</span>, <span class="st">"bit_3"</span>, <span class="st">"bit_2"</span>), <span class="at">sep =</span> <span class="st">""</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-5"><a href="#cb22-5"></a>  <span class="fu">unite</span>(<span class="at">col =</span> <span class="st">"band_2"</span>, </span>
<span id="cb22-6"><a href="#cb22-6"></a>        <span class="fu">c</span>(<span class="st">"bit_9"</span>, <span class="st">"bit_8"</span>, <span class="st">"bit_7"</span>, <span class="st">"bit_6"</span>), <span class="at">sep =</span> <span class="st">""</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-7"><a href="#cb22-7"></a>  <span class="fu">unite</span>(<span class="at">col =</span> <span class="st">"band_3"</span>, </span>
<span id="cb22-8"><a href="#cb22-8"></a>        <span class="fu">c</span>(<span class="st">"bit_13"</span>, <span class="st">"bit_12"</span>, <span class="st">"bit_11"</span>, <span class="st">"bit_10"</span>), <span class="at">sep =</span> <span class="st">""</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-9"><a href="#cb22-9"></a>  <span class="fu">unite</span>(<span class="at">col =</span> <span class="st">"band_4"</span>, </span>
<span id="cb22-10"><a href="#cb22-10"></a>        <span class="fu">c</span>(<span class="st">"bit_17"</span>, <span class="st">"bit_16"</span>, <span class="st">"bit_15"</span>, <span class="st">"bit_14"</span>), <span class="at">sep =</span> <span class="st">""</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-11"><a href="#cb22-11"></a>  <span class="fu">unite</span>(<span class="at">col =</span> <span class="st">"band_5"</span>, </span>
<span id="cb22-12"><a href="#cb22-12"></a>        <span class="fu">c</span>(<span class="st">"bit_21"</span>, <span class="st">"bit_20"</span>, <span class="st">"bit_19"</span>, <span class="st">"bit_18"</span>), <span class="at">sep =</span> <span class="st">""</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-13"><a href="#cb22-13"></a>  <span class="fu">unite</span>(<span class="at">col =</span> <span class="st">"band_6"</span>, </span>
<span id="cb22-14"><a href="#cb22-14"></a>        <span class="fu">c</span>(<span class="st">"bit_25"</span>, <span class="st">"bit_24"</span>, <span class="st">"bit_23"</span>, <span class="st">"bit_22"</span>), <span class="at">sep =</span> <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb22-15"><a href="#cb22-15"></a>  <span class="fu">unite</span>(<span class="at">col =</span> <span class="st">"band_7"</span>, </span>
<span id="cb22-16"><a href="#cb22-16"></a>        <span class="fu">c</span>(<span class="st">"bit_29"</span>, <span class="st">"bit_28"</span>, <span class="st">"bit_27"</span>, <span class="st">"bit_26"</span>), <span class="at">sep =</span> <span class="st">""</span>) <span class="sc">|&gt;</span> </span>
<span id="cb22-17"><a href="#cb22-17"></a>  <span class="fu">mutate</span>(<span class="at">modland_qa =</span> <span class="fu">case_when</span>(</span>
<span id="cb22-18"><a href="#cb22-18"></a>    modland <span class="sc">==</span> <span class="st">"00"</span> <span class="sc">~</span> <span class="st">"ideal quality - all bands"</span>,</span>
<span id="cb22-19"><a href="#cb22-19"></a>    modland <span class="sc">==</span> <span class="st">"01"</span> <span class="sc">~</span> <span class="st">"less than ideal quality - some or all bands"</span>,</span>
<span id="cb22-20"><a href="#cb22-20"></a>    modland <span class="sc">==</span> <span class="st">"10"</span> <span class="sc">~</span> <span class="st">"product not produced due to cloud effects"</span>,</span>
<span id="cb22-21"><a href="#cb22-21"></a>    modland <span class="sc">==</span> <span class="st">"11"</span> <span class="sc">~</span> <span class="st">"product not produced for other reasons"</span>,</span>
<span id="cb22-22"><a href="#cb22-22"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"No info, please validate bit conversion"</span></span>
<span id="cb22-23"><a href="#cb22-23"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb22-24"><a href="#cb22-24"></a>  <span class="fu">mutate</span>(<span class="at">band1_qa =</span> <span class="fu">case_when</span>(</span>
<span id="cb22-25"><a href="#cb22-25"></a>    band_1 <span class="sc">==</span> <span class="st">"0000"</span> <span class="sc">~</span> <span class="st">"highest_quality"</span>,</span>
<span id="cb22-26"><a href="#cb22-26"></a>    band_1 <span class="sc">==</span> <span class="st">"0111"</span> <span class="sc">~</span> <span class="st">"noisy detector"</span>,</span>
<span id="cb22-27"><a href="#cb22-27"></a>    band_1 <span class="sc">==</span> <span class="st">"1000"</span> <span class="sc">~</span> <span class="st">"dead detector, data interpolated in L1B"</span>,</span>
<span id="cb22-28"><a href="#cb22-28"></a>    band_1 <span class="sc">==</span> <span class="st">"1001"</span> <span class="sc">~</span> <span class="st">"solar zenith &gt;= 86 degrees"</span>,</span>
<span id="cb22-29"><a href="#cb22-29"></a>    band_1 <span class="sc">==</span> <span class="st">"1010"</span> <span class="sc">~</span> <span class="st">"solar zenith &gt;= 85 and &lt; 86 degrees"</span>,</span>
<span id="cb22-30"><a href="#cb22-30"></a>    band_1 <span class="sc">==</span> <span class="st">"1011"</span> <span class="sc">~</span> <span class="st">"missing input"</span>,</span>
<span id="cb22-31"><a href="#cb22-31"></a>    band_1 <span class="sc">==</span> <span class="st">"1100"</span> <span class="sc">~</span> <span class="st">"internal constant used"</span>,</span>
<span id="cb22-32"><a href="#cb22-32"></a>    band_1 <span class="sc">==</span> <span class="st">"1101"</span> <span class="sc">~</span> <span class="st">"correction out of bounds"</span>,</span>
<span id="cb22-33"><a href="#cb22-33"></a>    band_1 <span class="sc">==</span> <span class="st">"1110"</span> <span class="sc">~</span> <span class="st">"L1B data faulty"</span>,</span>
<span id="cb22-34"><a href="#cb22-34"></a>    band_1 <span class="sc">==</span> <span class="st">"1111"</span> <span class="sc">~</span> <span class="st">"not processed due to deep ocean or clouds"</span>,</span>
<span id="cb22-35"><a href="#cb22-35"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"No info, please validate bit conversion"</span></span>
<span id="cb22-36"><a href="#cb22-36"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb22-37"><a href="#cb22-37"></a>  <span class="fu">mutate</span>(<span class="at">band2_qa =</span> <span class="fu">case_when</span>(</span>
<span id="cb22-38"><a href="#cb22-38"></a>    band_2 <span class="sc">==</span> <span class="st">"0000"</span> <span class="sc">~</span> <span class="st">"highest_quality"</span>,</span>
<span id="cb22-39"><a href="#cb22-39"></a>    band_2 <span class="sc">==</span> <span class="st">"0111"</span> <span class="sc">~</span> <span class="st">"noisy detector"</span>,</span>
<span id="cb22-40"><a href="#cb22-40"></a>    band_2 <span class="sc">==</span> <span class="st">"1000"</span> <span class="sc">~</span> <span class="st">"dead detector, data interpolated in L1B"</span>,</span>
<span id="cb22-41"><a href="#cb22-41"></a>    band_2 <span class="sc">==</span> <span class="st">"1001"</span> <span class="sc">~</span> <span class="st">"solar zenith &gt;= 86 degrees"</span>,</span>
<span id="cb22-42"><a href="#cb22-42"></a>    band_2 <span class="sc">==</span> <span class="st">"1010"</span> <span class="sc">~</span> <span class="st">"solar zenith &gt;= 85 and &lt; 86 degrees"</span>,</span>
<span id="cb22-43"><a href="#cb22-43"></a>    band_2 <span class="sc">==</span> <span class="st">"1011"</span> <span class="sc">~</span> <span class="st">"missing input"</span>,</span>
<span id="cb22-44"><a href="#cb22-44"></a>    band_2 <span class="sc">==</span> <span class="st">"1100"</span> <span class="sc">~</span> <span class="st">"internal constant used"</span>,</span>
<span id="cb22-45"><a href="#cb22-45"></a>    band_2 <span class="sc">==</span> <span class="st">"1101"</span> <span class="sc">~</span> <span class="st">"correction out of bounds"</span>,</span>
<span id="cb22-46"><a href="#cb22-46"></a>    band_2 <span class="sc">==</span> <span class="st">"1110"</span> <span class="sc">~</span> <span class="st">"L1B data faulty"</span>,</span>
<span id="cb22-47"><a href="#cb22-47"></a>    band_2 <span class="sc">==</span> <span class="st">"1111"</span> <span class="sc">~</span> <span class="st">"not processed due to deep ocean or clouds"</span>,</span>
<span id="cb22-48"><a href="#cb22-48"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"No info, please validate bit conversion"</span></span>
<span id="cb22-49"><a href="#cb22-49"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb22-50"><a href="#cb22-50"></a>  <span class="fu">mutate</span>(<span class="at">band3_qa =</span> <span class="fu">case_when</span>(</span>
<span id="cb22-51"><a href="#cb22-51"></a>    band_3 <span class="sc">==</span> <span class="st">"0000"</span> <span class="sc">~</span> <span class="st">"highest_quality"</span>,</span>
<span id="cb22-52"><a href="#cb22-52"></a>    band_3 <span class="sc">==</span> <span class="st">"0111"</span> <span class="sc">~</span> <span class="st">"noisy detector"</span>,</span>
<span id="cb22-53"><a href="#cb22-53"></a>    band_3 <span class="sc">==</span> <span class="st">"1000"</span> <span class="sc">~</span> <span class="st">"dead detector, data interpolated in L1B"</span>,</span>
<span id="cb22-54"><a href="#cb22-54"></a>    band_3 <span class="sc">==</span> <span class="st">"1001"</span> <span class="sc">~</span> <span class="st">"solar zenith &gt;= 86 degrees"</span>,</span>
<span id="cb22-55"><a href="#cb22-55"></a>    band_3 <span class="sc">==</span> <span class="st">"1010"</span> <span class="sc">~</span> <span class="st">"solar zenith &gt;= 85 and &lt; 86 degrees"</span>,</span>
<span id="cb22-56"><a href="#cb22-56"></a>    band_3 <span class="sc">==</span> <span class="st">"1011"</span> <span class="sc">~</span> <span class="st">"missing input"</span>,</span>
<span id="cb22-57"><a href="#cb22-57"></a>    band_3 <span class="sc">==</span> <span class="st">"1100"</span> <span class="sc">~</span> <span class="st">"internal constant used"</span>,</span>
<span id="cb22-58"><a href="#cb22-58"></a>    band_3 <span class="sc">==</span> <span class="st">"1101"</span> <span class="sc">~</span> <span class="st">"correction out of bounds"</span>,</span>
<span id="cb22-59"><a href="#cb22-59"></a>    band_3 <span class="sc">==</span> <span class="st">"1110"</span> <span class="sc">~</span> <span class="st">"L1B data faulty"</span>,</span>
<span id="cb22-60"><a href="#cb22-60"></a>    band_3 <span class="sc">==</span> <span class="st">"1111"</span> <span class="sc">~</span> <span class="st">"not processed due to deep ocean or clouds"</span>,</span>
<span id="cb22-61"><a href="#cb22-61"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"No info, please validate bit conversion"</span></span>
<span id="cb22-62"><a href="#cb22-62"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb22-63"><a href="#cb22-63"></a>  <span class="fu">mutate</span>(<span class="at">band4_qa =</span> <span class="fu">case_when</span>(</span>
<span id="cb22-64"><a href="#cb22-64"></a>    band_4 <span class="sc">==</span> <span class="st">"0000"</span> <span class="sc">~</span> <span class="st">"highest_quality"</span>,</span>
<span id="cb22-65"><a href="#cb22-65"></a>    band_4 <span class="sc">==</span> <span class="st">"0111"</span> <span class="sc">~</span> <span class="st">"noisy detector"</span>,</span>
<span id="cb22-66"><a href="#cb22-66"></a>    band_4 <span class="sc">==</span> <span class="st">"1000"</span> <span class="sc">~</span> <span class="st">"dead detector, data interpolated in L1B"</span>,</span>
<span id="cb22-67"><a href="#cb22-67"></a>    band_4 <span class="sc">==</span> <span class="st">"1001"</span> <span class="sc">~</span> <span class="st">"solar zenith &gt;= 86 degrees"</span>,</span>
<span id="cb22-68"><a href="#cb22-68"></a>    band_4 <span class="sc">==</span> <span class="st">"1010"</span> <span class="sc">~</span> <span class="st">"solar zenith &gt;= 85 and &lt; 86 degrees"</span>,</span>
<span id="cb22-69"><a href="#cb22-69"></a>    band_4 <span class="sc">==</span> <span class="st">"1011"</span> <span class="sc">~</span> <span class="st">"missing input"</span>,</span>
<span id="cb22-70"><a href="#cb22-70"></a>    band_4 <span class="sc">==</span> <span class="st">"1100"</span> <span class="sc">~</span> <span class="st">"internal constant used"</span>,</span>
<span id="cb22-71"><a href="#cb22-71"></a>    band_4 <span class="sc">==</span> <span class="st">"1101"</span> <span class="sc">~</span> <span class="st">"correction out of bounds"</span>,</span>
<span id="cb22-72"><a href="#cb22-72"></a>    band_4 <span class="sc">==</span> <span class="st">"1110"</span> <span class="sc">~</span> <span class="st">"L1B data faulty"</span>,</span>
<span id="cb22-73"><a href="#cb22-73"></a>    band_4 <span class="sc">==</span> <span class="st">"1111"</span> <span class="sc">~</span> <span class="st">"not processed due to deep ocean or clouds"</span>,</span>
<span id="cb22-74"><a href="#cb22-74"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"No info, please validate bit conversion"</span></span>
<span id="cb22-75"><a href="#cb22-75"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb22-76"><a href="#cb22-76"></a>  <span class="fu">mutate</span>(<span class="at">band5_qa =</span> <span class="fu">case_when</span>(</span>
<span id="cb22-77"><a href="#cb22-77"></a>    band_5 <span class="sc">==</span> <span class="st">"0000"</span> <span class="sc">~</span> <span class="st">"highest_quality"</span>,</span>
<span id="cb22-78"><a href="#cb22-78"></a>    band_5 <span class="sc">==</span> <span class="st">"0111"</span> <span class="sc">~</span> <span class="st">"noisy detector"</span>,</span>
<span id="cb22-79"><a href="#cb22-79"></a>    band_5 <span class="sc">==</span> <span class="st">"1000"</span> <span class="sc">~</span> <span class="st">"dead detector, data interpolated in L1B"</span>,</span>
<span id="cb22-80"><a href="#cb22-80"></a>    band_5 <span class="sc">==</span> <span class="st">"1001"</span> <span class="sc">~</span> <span class="st">"solar zenith &gt;= 86 degrees"</span>,</span>
<span id="cb22-81"><a href="#cb22-81"></a>    band_5 <span class="sc">==</span> <span class="st">"1010"</span> <span class="sc">~</span> <span class="st">"solar zenith &gt;= 85 and &lt; 86 degrees"</span>,</span>
<span id="cb22-82"><a href="#cb22-82"></a>    band_5 <span class="sc">==</span> <span class="st">"1011"</span> <span class="sc">~</span> <span class="st">"missing input"</span>,</span>
<span id="cb22-83"><a href="#cb22-83"></a>    band_5 <span class="sc">==</span> <span class="st">"1100"</span> <span class="sc">~</span> <span class="st">"internal constant used"</span>,</span>
<span id="cb22-84"><a href="#cb22-84"></a>    band_5 <span class="sc">==</span> <span class="st">"1101"</span> <span class="sc">~</span> <span class="st">"correction out of bounds"</span>,</span>
<span id="cb22-85"><a href="#cb22-85"></a>    band_5 <span class="sc">==</span> <span class="st">"1110"</span> <span class="sc">~</span> <span class="st">"L1B data faulty"</span>,</span>
<span id="cb22-86"><a href="#cb22-86"></a>    band_5 <span class="sc">==</span> <span class="st">"1111"</span> <span class="sc">~</span> <span class="st">"not processed due to deep ocean or clouds"</span>,</span>
<span id="cb22-87"><a href="#cb22-87"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"No info, please validate bit conversion"</span></span>
<span id="cb22-88"><a href="#cb22-88"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb22-89"><a href="#cb22-89"></a>  <span class="fu">mutate</span>(<span class="at">band6_qa =</span> <span class="fu">case_when</span>(</span>
<span id="cb22-90"><a href="#cb22-90"></a>    band_6 <span class="sc">==</span> <span class="st">"0000"</span> <span class="sc">~</span> <span class="st">"highest_quality"</span>,</span>
<span id="cb22-91"><a href="#cb22-91"></a>    band_6 <span class="sc">==</span> <span class="st">"0111"</span> <span class="sc">~</span> <span class="st">"noisy detector"</span>,</span>
<span id="cb22-92"><a href="#cb22-92"></a>    band_6 <span class="sc">==</span> <span class="st">"1000"</span> <span class="sc">~</span> <span class="st">"dead detector, data interpolated in L1B"</span>,</span>
<span id="cb22-93"><a href="#cb22-93"></a>    band_6 <span class="sc">==</span> <span class="st">"1001"</span> <span class="sc">~</span> <span class="st">"solar zenith &gt;= 86 degrees"</span>,</span>
<span id="cb22-94"><a href="#cb22-94"></a>    band_6 <span class="sc">==</span> <span class="st">"1010"</span> <span class="sc">~</span> <span class="st">"solar zenith &gt;= 85 and &lt; 86 degrees"</span>,</span>
<span id="cb22-95"><a href="#cb22-95"></a>    band_6 <span class="sc">==</span> <span class="st">"1011"</span> <span class="sc">~</span> <span class="st">"missing input"</span>,</span>
<span id="cb22-96"><a href="#cb22-96"></a>    band_6 <span class="sc">==</span> <span class="st">"1100"</span> <span class="sc">~</span> <span class="st">"internal constant used"</span>,</span>
<span id="cb22-97"><a href="#cb22-97"></a>    band_6 <span class="sc">==</span> <span class="st">"1101"</span> <span class="sc">~</span> <span class="st">"correction out of bounds"</span>,</span>
<span id="cb22-98"><a href="#cb22-98"></a>    band_6 <span class="sc">==</span> <span class="st">"1110"</span> <span class="sc">~</span> <span class="st">"L1B data faulty"</span>,</span>
<span id="cb22-99"><a href="#cb22-99"></a>    band_6 <span class="sc">==</span> <span class="st">"1111"</span> <span class="sc">~</span> <span class="st">"not processed due to deep ocean or clouds"</span>,</span>
<span id="cb22-100"><a href="#cb22-100"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"No info, please validate bit conversion"</span></span>
<span id="cb22-101"><a href="#cb22-101"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb22-102"><a href="#cb22-102"></a>  <span class="fu">mutate</span>(<span class="at">band7_qa =</span> <span class="fu">case_when</span>(</span>
<span id="cb22-103"><a href="#cb22-103"></a>    band_7 <span class="sc">==</span> <span class="st">"0000"</span> <span class="sc">~</span> <span class="st">"highest_quality"</span>,</span>
<span id="cb22-104"><a href="#cb22-104"></a>    band_7 <span class="sc">==</span> <span class="st">"0111"</span> <span class="sc">~</span> <span class="st">"noisy detector"</span>,</span>
<span id="cb22-105"><a href="#cb22-105"></a>    band_7 <span class="sc">==</span> <span class="st">"1000"</span> <span class="sc">~</span> <span class="st">"dead detector, data interpolated in L1B"</span>,</span>
<span id="cb22-106"><a href="#cb22-106"></a>    band_7 <span class="sc">==</span> <span class="st">"1001"</span> <span class="sc">~</span> <span class="st">"solar zenith &gt;= 86 degrees"</span>,</span>
<span id="cb22-107"><a href="#cb22-107"></a>    band_7 <span class="sc">==</span> <span class="st">"1010"</span> <span class="sc">~</span> <span class="st">"solar zenith &gt;= 85 and &lt; 86 degrees"</span>,</span>
<span id="cb22-108"><a href="#cb22-108"></a>    band_7 <span class="sc">==</span> <span class="st">"1011"</span> <span class="sc">~</span> <span class="st">"missing input"</span>,</span>
<span id="cb22-109"><a href="#cb22-109"></a>    band_7 <span class="sc">==</span> <span class="st">"1100"</span> <span class="sc">~</span> <span class="st">"internal constant used"</span>,</span>
<span id="cb22-110"><a href="#cb22-110"></a>    band_7 <span class="sc">==</span> <span class="st">"1101"</span> <span class="sc">~</span> <span class="st">"correction out of bounds"</span>,</span>
<span id="cb22-111"><a href="#cb22-111"></a>    band_7 <span class="sc">==</span> <span class="st">"1110"</span> <span class="sc">~</span> <span class="st">"L1B data faulty"</span>,</span>
<span id="cb22-112"><a href="#cb22-112"></a>    band_7 <span class="sc">==</span> <span class="st">"1111"</span> <span class="sc">~</span> <span class="st">"not processed due to deep ocean or clouds"</span>,</span>
<span id="cb22-113"><a href="#cb22-113"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"No info, please validate bit conversion"</span></span>
<span id="cb22-114"><a href="#cb22-114"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb22-115"><a href="#cb22-115"></a>  <span class="fu">mutate</span>(<span class="at">atmospheric_correction =</span> <span class="fu">ifelse</span>(bit_30 <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"no"</span>, <span class="st">"yes"</span>),</span>
<span id="cb22-116"><a href="#cb22-116"></a>         <span class="at">adjacency_correction =</span> <span class="fu">ifelse</span>(bit_31 <span class="sc">==</span> <span class="dv">0</span>, <span class="st">"no"</span>, <span class="st">"yes"</span>))</span>
<span id="cb22-117"><a href="#cb22-117"></a></span>
<span id="cb22-118"><a href="#cb22-118"></a><span class="fu">paged_table</span>(qc_500_description)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["qc_ints"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["bit_31"],"name":[2],"type":["int"],"align":["right"]},{"label":["bit_30"],"name":[3],"type":["int"],"align":["right"]},{"label":["band_7"],"name":[4],"type":["chr"],"align":["left"]},{"label":["band_6"],"name":[5],"type":["chr"],"align":["left"]},{"label":["band_5"],"name":[6],"type":["chr"],"align":["left"]},{"label":["band_4"],"name":[7],"type":["chr"],"align":["left"]},{"label":["band_3"],"name":[8],"type":["chr"],"align":["left"]},{"label":["band_2"],"name":[9],"type":["chr"],"align":["left"]},{"label":["band_1"],"name":[10],"type":["chr"],"align":["left"]},{"label":["modland"],"name":[11],"type":["chr"],"align":["left"]},{"label":["modland_qa"],"name":[12],"type":["chr"],"align":["left"]},{"label":["band1_qa"],"name":[13],"type":["chr"],"align":["left"]},{"label":["band2_qa"],"name":[14],"type":["chr"],"align":["left"]},{"label":["band3_qa"],"name":[15],"type":["chr"],"align":["left"]},{"label":["band4_qa"],"name":[16],"type":["chr"],"align":["left"]},{"label":["band5_qa"],"name":[17],"type":["chr"],"align":["left"]},{"label":["band6_qa"],"name":[18],"type":["chr"],"align":["left"]},{"label":["band7_qa"],"name":[19],"type":["chr"],"align":["left"]},{"label":["atmospheric_correction"],"name":[20],"type":["chr"],"align":["left"]},{"label":["adjacency_correction"],"name":[21],"type":["chr"],"align":["left"]}],"data":[{"1":"1073741824","2":"0","3":"1","4":"0000","5":"0000","6":"0000","7":"0000","8":"0000","9":"0000","10":"0000","11":"00","12":"ideal quality - all bands","13":"highest_quality","14":"highest_quality","15":"highest_quality","16":"highest_quality","17":"highest_quality","18":"highest_quality","19":"highest_quality","20":"yes","21":"no"},{"1":"1073968181","2":"0","3":"1","4":"0000","5":"0000","6":"0000","7":"1101","8":"1101","9":"0000","10":"1101","11":"01","12":"less than ideal quality - some or all bands","13":"correction out of bounds","14":"highest_quality","15":"correction out of bounds","16":"correction out of bounds","17":"highest_quality","18":"highest_quality","19":"highest_quality","20":"yes","21":"no"},{"1":"1073954817","2":"0","3":"1","4":"0000","5":"0000","6":"0000","7":"1101","8":"0000","9":"0000","10":"0000","11":"01","12":"less than ideal quality - some or all bands","13":"highest_quality","14":"highest_quality","15":"highest_quality","16":"correction out of bounds","17":"highest_quality","18":"highest_quality","19":"highest_quality","20":"yes","21":"no"},{"1":"1075838976","2":"0","3":"1","4":"0000","5":"0000","6":"1000","7":"0000","8":"0000","9":"0000","10":"0000","11":"00","12":"ideal quality - all bands","13":"highest_quality","14":"highest_quality","15":"highest_quality","16":"highest_quality","17":"dead detector, data interpolated in L1B","18":"highest_quality","19":"highest_quality","20":"yes","21":"no"},{"1":"1073968129","2":"0","3":"1","4":"0000","5":"0000","6":"0000","7":"1101","8":"1101","9":"0000","10":"0000","11":"01","12":"less than ideal quality - some or all bands","13":"highest_quality","14":"highest_quality","15":"correction out of bounds","16":"correction out of bounds","17":"highest_quality","18":"highest_quality","19":"highest_quality","20":"yes","21":"no"},{"1":"1073755137","2":"0","3":"1","4":"0000","5":"0000","6":"0000","7":"0000","8":"1101","9":"0000","10":"0000","11":"01","12":"less than ideal quality - some or all bands","13":"highest_quality","14":"highest_quality","15":"correction out of bounds","16":"highest_quality","17":"highest_quality","18":"highest_quality","19":"highest_quality","20":"yes","21":"no"},{"1":"1073755189","2":"0","3":"1","4":"0000","5":"0000","6":"0000","7":"0000","8":"1101","9":"0000","10":"1101","11":"01","12":"less than ideal quality - some or all bands","13":"correction out of bounds","14":"highest_quality","15":"correction out of bounds","16":"highest_quality","17":"highest_quality","18":"highest_quality","19":"highest_quality","20":"yes","21":"no"},{"1":"1075852341","2":"0","3":"1","4":"0000","5":"0000","6":"1000","7":"0000","8":"1101","9":"0000","10":"1101","11":"01","12":"less than ideal quality - some or all bands","13":"correction out of bounds","14":"highest_quality","15":"correction out of bounds","16":"highest_quality","17":"dead detector, data interpolated in L1B","18":"highest_quality","19":"highest_quality","20":"yes","21":"no"},{"1":"1076065281","2":"0","3":"1","4":"0000","5":"0000","6":"1000","7":"1101","8":"1101","9":"0000","10":"0000","11":"01","12":"less than ideal quality - some or all bands","13":"highest_quality","14":"highest_quality","15":"correction out of bounds","16":"correction out of bounds","17":"dead detector, data interpolated in L1B","18":"highest_quality","19":"highest_quality","20":"yes","21":"no"},{"1":"1946383413","2":"0","3":"1","4":"1101","5":"0000","6":"0000","7":"1101","8":"1101","9":"0000","10":"1101","11":"01","12":"less than ideal quality - some or all bands","13":"correction out of bounds","14":"highest_quality","15":"correction out of bounds","16":"correction out of bounds","17":"highest_quality","18":"highest_quality","19":"correction out of bounds","20":"yes","21":"no"},{"1":"1073969013","2":"0","3":"1","4":"0000","5":"0000","6":"0000","7":"1101","8":"1101","9":"1101","10":"1101","11":"01","12":"less than ideal quality - some or all bands","13":"correction out of bounds","14":"correction out of bounds","15":"correction out of bounds","16":"correction out of bounds","17":"highest_quality","18":"highest_quality","19":"highest_quality","20":"yes","21":"no"},{"1":"1073954869","2":"0","3":"1","4":"0000","5":"0000","6":"0000","7":"1101","8":"0000","9":"0000","10":"1101","11":"01","12":"less than ideal quality - some or all bands","13":"correction out of bounds","14":"highest_quality","15":"highest_quality","16":"correction out of bounds","17":"highest_quality","18":"highest_quality","19":"highest_quality","20":"yes","21":"no"},{"1":"1075852289","2":"0","3":"1","4":"0000","5":"0000","6":"1000","7":"0000","8":"1101","9":"0000","10":"0000","11":"01","12":"less than ideal quality - some or all bands","13":"highest_quality","14":"highest_quality","15":"correction out of bounds","16":"highest_quality","17":"dead detector, data interpolated in L1B","18":"highest_quality","19":"highest_quality","20":"yes","21":"no"},{"1":"1076065333","2":"0","3":"1","4":"0000","5":"0000","6":"1000","7":"1101","8":"1101","9":"0000","10":"1101","11":"01","12":"less than ideal quality - some or all bands","13":"correction out of bounds","14":"highest_quality","15":"correction out of bounds","16":"correction out of bounds","17":"dead detector, data interpolated in L1B","18":"highest_quality","19":"highest_quality","20":"yes","21":"no"},{"1":"1076051969","2":"0","3":"1","4":"0000","5":"0000","6":"1000","7":"1101","8":"0000","9":"0000","10":"0000","11":"01","12":"less than ideal quality - some or all bands","13":"highest_quality","14":"highest_quality","15":"highest_quality","16":"correction out of bounds","17":"dead detector, data interpolated in L1B","18":"highest_quality","19":"highest_quality","20":"yes","21":"no"},{"1":"1075576832","2":"0","3":"1","4":"0000","5":"0000","6":"0111","7":"0000","8":"0000","9":"0000","10":"0000","11":"00","12":"ideal quality - all bands","13":"highest_quality","14":"highest_quality","15":"highest_quality","16":"highest_quality","17":"noisy detector","18":"highest_quality","19":"highest_quality","20":"yes","21":"no"},{"1":"1075590145","2":"0","3":"1","4":"0000","5":"0000","6":"0111","7":"0000","8":"1101","9":"0000","10":"0000","11":"01","12":"less than ideal quality - some or all bands","13":"highest_quality","14":"highest_quality","15":"correction out of bounds","16":"highest_quality","17":"noisy detector","18":"highest_quality","19":"highest_quality","20":"yes","21":"no"},{"1":"1075803189","2":"0","3":"1","4":"0000","5":"0000","6":"0111","7":"1101","8":"1101","9":"0000","10":"1101","11":"01","12":"less than ideal quality - some or all bands","13":"correction out of bounds","14":"highest_quality","15":"correction out of bounds","16":"correction out of bounds","17":"noisy detector","18":"highest_quality","19":"highest_quality","20":"yes","21":"no"},{"1":"1131675649","2":"0","3":"1","4":"0000","5":"1101","6":"1101","7":"0000","8":"0000","9":"0000","10":"0000","11":"01","12":"less than ideal quality - some or all bands","13":"highest_quality","14":"highest_quality","15":"highest_quality","16":"highest_quality","17":"correction out of bounds","18":"correction out of bounds","19":"highest_quality","20":"yes","21":"no"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p>That’s a big table, so to understand better, let’s check just the MODLAND QA bits categorization:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>qc_500_description <span class="sc">|&gt;</span> </span>
<span id="cb23-2"><a href="#cb23-2"></a>        <span class="fu">select</span>(modland, modland_qa, qc_ints) <span class="sc">|&gt;</span> </span>
<span id="cb23-3"><a href="#cb23-3"></a>        <span class="fu">paged_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["modland"],"name":[1],"type":["chr"],"align":["left"]},{"label":["modland_qa"],"name":[2],"type":["chr"],"align":["left"]},{"label":["qc_ints"],"name":[3],"type":["dbl"],"align":["right"]}],"data":[{"1":"00","2":"ideal quality - all bands","3":"1073741824"},{"1":"01","2":"less than ideal quality - some or all bands","3":"1073968181"},{"1":"01","2":"less than ideal quality - some or all bands","3":"1073954817"},{"1":"00","2":"ideal quality - all bands","3":"1075838976"},{"1":"01","2":"less than ideal quality - some or all bands","3":"1073968129"},{"1":"01","2":"less than ideal quality - some or all bands","3":"1073755137"},{"1":"01","2":"less than ideal quality - some or all bands","3":"1073755189"},{"1":"01","2":"less than ideal quality - some or all bands","3":"1075852341"},{"1":"01","2":"less than ideal quality - some or all bands","3":"1076065281"},{"1":"01","2":"less than ideal quality - some or all bands","3":"1946383413"},{"1":"01","2":"less than ideal quality - some or all bands","3":"1073969013"},{"1":"01","2":"less than ideal quality - some or all bands","3":"1073954869"},{"1":"01","2":"less than ideal quality - some or all bands","3":"1075852289"},{"1":"01","2":"less than ideal quality - some or all bands","3":"1076065333"},{"1":"01","2":"less than ideal quality - some or all bands","3":"1076051969"},{"1":"00","2":"ideal quality - all bands","3":"1075576832"},{"1":"01","2":"less than ideal quality - some or all bands","3":"1075590145"},{"1":"01","2":"less than ideal quality - some or all bands","3":"1075803189"},{"1":"01","2":"less than ideal quality - some or all bands","3":"1131675649"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><img src="images/modland_qa.png" class="img-fluid"></p>
<p>From our dataset, we obtained two of the categories from the total 4. The <code>qc_ints</code> have 19 different observations in total, but those integers will give us information for the rest of the parameters.</p>
<!-- Is there a way to establish the same code for the bands given that they have -->
<!-- the same categories? -->
</section>
<section id="proof-of-concept-for-16-bits" class="level2">
<h2 class="anchored" data-anchor-id="proof-of-concept-for-16-bits">Proof of concept for 16 bits</h2>
<p>So far we have all the steps to perform the binary conversion for a variable that consist on 32 bits. Nonetheless, other variables could use less bits such as <code>state_1km</code> which uses <strong>16 bits</strong>. Here, I’m going to apply the same process described above to this variable but with some changes in the code indicating the quantity of bits to be used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="do">## Check unique values and add one validation (from the video)</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>qc_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">qc_ints =</span> <span class="fu">c</span>(<span class="fu">unique</span>(reflectance_500<span class="sc">$</span>state_1km),</span>
<span id="cb24-3"><a href="#cb24-3"></a>                                  <span class="dv">1131675649</span>))</span>
<span id="cb24-4"><a href="#cb24-4"></a></span>
<span id="cb24-5"><a href="#cb24-5"></a><span class="do">## Create empty data frame. This case is 32 given that the variable</span></span>
<span id="cb24-6"><a href="#cb24-6"></a><span class="do">## `qc_500m` have 32 bits</span></span>
<span id="cb24-7"><a href="#cb24-7"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">15</span><span class="sc">:</span><span class="dv">0</span>)) {</span>
<span id="cb24-8"><a href="#cb24-8"></a>  qc_data[, <span class="fu">paste0</span>(<span class="st">"bit_"</span>, i)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb24-9"><a href="#cb24-9"></a>}</span>
<span id="cb24-10"><a href="#cb24-10"></a></span>
<span id="cb24-11"><a href="#cb24-11"></a><span class="co"># Loop for obtaining bit string from unique values in the variable</span></span>
<span id="cb24-12"><a href="#cb24-12"></a>z <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb24-13"><a href="#cb24-13"></a><span class="cf">for</span> (i <span class="cf">in</span> qc_data<span class="sc">$</span>qc_ints) {</span>
<span id="cb24-14"><a href="#cb24-14"></a>  <span class="co"># print(i)</span></span>
<span id="cb24-15"><a href="#cb24-15"></a>  transformed <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">intToBits</span>(i)[<span class="dv">1</span><span class="sc">:</span><span class="dv">16</span>])</span>
<span id="cb24-16"><a href="#cb24-16"></a>  qc_data[z, <span class="dv">2</span><span class="sc">:</span><span class="dv">17</span>] <span class="ot">&lt;-</span> transformed[<span class="dv">16</span><span class="sc">:</span><span class="dv">1</span>]</span>
<span id="cb24-17"><a href="#cb24-17"></a>  z <span class="ot">&lt;-</span> z <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb24-18"><a href="#cb24-18"></a>}</span>
<span id="cb24-19"><a href="#cb24-19"></a></span>
<span id="cb24-20"><a href="#cb24-20"></a><span class="do">## Create test according to value in video</span></span>
<span id="cb24-21"><a href="#cb24-21"></a>process_test <span class="ot">&lt;-</span> qc_data <span class="sc">|&gt;</span> </span>
<span id="cb24-22"><a href="#cb24-22"></a>  <span class="fu">filter</span>(qc_ints <span class="sc">==</span> <span class="dv">1131675649</span>) <span class="sc">|&gt;</span></span>
<span id="cb24-23"><a href="#cb24-23"></a>  <span class="fu">select</span>(<span class="sc">-</span>qc_ints) <span class="sc">|&gt;</span></span>
<span id="cb24-24"><a href="#cb24-24"></a>  <span class="fu">unite</span>(<span class="at">col =</span> <span class="st">"new"</span>, bit_15<span class="sc">:</span>bit_0, <span class="at">sep =</span> <span class="st">""</span>) <span class="sc">|&gt;</span> </span>
<span id="cb24-25"><a href="#cb24-25"></a>  <span class="fu">pull</span>() </span>
<span id="cb24-26"><a href="#cb24-26"></a></span>
<span id="cb24-27"><a href="#cb24-27"></a><span class="fu">stopifnot</span>(process_test <span class="sc">==</span> <span class="st">"0000000000000001"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Looks like we were able to succesfuly pass our test. Let’s check how the dataset with the binary conversion looks like:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="fu">paged_table</span>(qc_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["qc_ints"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["bit_15"],"name":[2],"type":["int"],"align":["right"]},{"label":["bit_14"],"name":[3],"type":["int"],"align":["right"]},{"label":["bit_13"],"name":[4],"type":["int"],"align":["right"]},{"label":["bit_12"],"name":[5],"type":["int"],"align":["right"]},{"label":["bit_11"],"name":[6],"type":["int"],"align":["right"]},{"label":["bit_10"],"name":[7],"type":["int"],"align":["right"]},{"label":["bit_9"],"name":[8],"type":["int"],"align":["right"]},{"label":["bit_8"],"name":[9],"type":["int"],"align":["right"]},{"label":["bit_7"],"name":[10],"type":["int"],"align":["right"]},{"label":["bit_6"],"name":[11],"type":["int"],"align":["right"]},{"label":["bit_5"],"name":[12],"type":["int"],"align":["right"]},{"label":["bit_4"],"name":[13],"type":["int"],"align":["right"]},{"label":["bit_3"],"name":[14],"type":["int"],"align":["right"]},{"label":["bit_2"],"name":[15],"type":["int"],"align":["right"]},{"label":["bit_1"],"name":[16],"type":["int"],"align":["right"]},{"label":["bit_0"],"name":[17],"type":["int"],"align":["right"]}],"data":[{"1":"1033","2":"0","3":"0","4":"0","5":"0","6":"0","7":"1","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"0","17":"1"},{"1":"40969","2":"1","3":"0","4":"1","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"0","17":"1"},{"1":"8392","2":"0","3":"0","4":"1","5":"0","6":"0","7":"0","8":"0","9":"0","10":"1","11":"1","12":"0","13":"0","14":"1","15":"0","16":"0","17":"0"},{"1":"1034","2":"0","3":"0","4":"0","5":"0","6":"0","7":"1","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"1","17":"0"},{"1":"40970","2":"1","3":"0","4":"1","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"1","17":"0"},{"1":"5384","2":"0","3":"0","4":"0","5":"1","6":"0","7":"1","8":"0","9":"1","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"0","17":"0"},{"1":"1289","2":"0","3":"0","4":"0","5":"0","6":"0","7":"1","8":"0","9":"1","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"0","17":"1"},{"1":"1801","2":"0","3":"0","4":"0","5":"0","6":"0","7":"1","8":"1","9":"1","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"0","17":"1"},{"1":"45068","2":"1","3":"0","4":"1","5":"1","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"1","16":"0","17":"0"},{"1":"1545","2":"0","3":"0","4":"0","5":"0","6":"0","7":"1","8":"1","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"0","17":"1"},{"1":"8397","2":"0","3":"0","4":"1","5":"0","6":"0","7":"0","8":"0","9":"0","10":"1","11":"1","12":"0","13":"0","14":"1","15":"1","16":"0","17":"1"},{"1":"8398","2":"0","3":"0","4":"1","5":"0","6":"0","7":"0","8":"0","9":"0","10":"1","11":"1","12":"0","13":"0","14":"1","15":"1","16":"1","17":"0"},{"1":"1032","2":"0","3":"0","4":"0","5":"0","6":"0","7":"1","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"0","17":"0"},{"1":"8396","2":"0","3":"0","4":"1","5":"0","6":"0","7":"0","8":"0","9":"0","10":"1","11":"1","12":"0","13":"0","14":"1","15":"1","16":"0","17":"0"},{"1":"8393","2":"0","3":"0","4":"1","5":"0","6":"0","7":"0","8":"0","9":"0","10":"1","11":"1","12":"0","13":"0","14":"1","15":"0","16":"0","17":"1"},{"1":"5128","2":"0","3":"0","4":"0","5":"1","6":"0","7":"1","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"0","17":"0"},{"1":"40973","2":"1","3":"0","4":"1","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"1","16":"0","17":"1"},{"1":"40974","2":"1","3":"0","4":"1","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"1","16":"1","17":"0"},{"1":"45064","2":"1","3":"0","4":"1","5":"1","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"0","17":"0"},{"1":"8394","2":"0","3":"0","4":"1","5":"0","6":"0","7":"0","8":"0","9":"0","10":"1","11":"1","12":"0","13":"0","14":"1","15":"0","16":"1","17":"0"},{"1":"32781","2":"1","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"1","16":"0","17":"1"},{"1":"206","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"1","11":"1","12":"0","13":"0","14":"1","15":"1","16":"1","17":"0"},{"1":"36872","2":"1","3":"0","4":"0","5":"1","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"0","17":"0"},{"1":"32778","2":"1","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"1","17":"0"},{"1":"32777","2":"1","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"0","17":"1"},{"1":"5640","2":"0","3":"0","4":"0","5":"1","6":"0","7":"1","8":"1","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"0","17":"0"},{"1":"36876","2":"1","3":"0","4":"0","5":"1","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"1","16":"0","17":"0"},{"1":"32776","2":"1","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"0","17":"0"},{"1":"45066","2":"1","3":"0","4":"1","5":"1","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"1","17":"0"},{"1":"8334","2":"0","3":"0","4":"1","5":"0","6":"0","7":"0","8":"0","9":"0","10":"1","11":"0","12":"0","13":"0","14":"1","15":"1","16":"1","17":"0"},{"1":"200","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"1","11":"1","12":"0","13":"0","14":"1","15":"0","16":"0","17":"0"},{"1":"138","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"1","11":"0","12":"0","13":"0","14":"1","15":"0","16":"1","17":"0"},{"1":"136","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"1","11":"0","12":"0","13":"0","14":"1","15":"0","16":"0","17":"0"},{"1":"8","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"0","17":"0"},{"1":"72","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"1","12":"0","13":"0","14":"1","15":"0","16":"0","17":"0"},{"1":"8264","2":"0","3":"0","4":"1","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"1","12":"0","13":"0","14":"1","15":"0","16":"0","17":"0"},{"1":"1544","2":"0","3":"0","4":"0","5":"0","6":"0","7":"1","8":"1","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"0","17":"0"},{"1":"8332","2":"0","3":"0","4":"1","5":"0","6":"0","7":"0","8":"0","9":"0","10":"1","11":"0","12":"0","13":"0","14":"1","15":"1","16":"0","17":"0"},{"1":"1802","2":"0","3":"0","4":"0","5":"0","6":"0","7":"1","8":"1","9":"1","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"1","17":"0"},{"1":"1288","2":"0","3":"0","4":"0","5":"0","6":"0","7":"1","8":"0","9":"1","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"0","17":"0"},{"1":"8328","2":"0","3":"0","4":"1","5":"0","6":"0","7":"0","8":"0","9":"0","10":"1","11":"0","12":"0","13":"0","14":"1","15":"0","16":"0","17":"0"},{"1":"1546","2":"0","3":"0","4":"0","5":"0","6":"0","7":"1","8":"1","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"1","17":"0"},{"1":"8268","2":"0","3":"0","4":"1","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"1","12":"0","13":"0","14":"1","15":"1","16":"0","17":"0"},{"1":"8330","2":"0","3":"0","4":"1","5":"0","6":"0","7":"0","8":"0","9":"0","10":"1","11":"0","12":"0","13":"0","14":"1","15":"0","16":"1","17":"0"},{"1":"8205","2":"0","3":"0","4":"1","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"1","16":"0","17":"1"},{"1":"76","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"1","12":"0","13":"0","14":"1","15":"1","16":"0","17":"0"},{"1":"204","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"1","11":"1","12":"0","13":"0","14":"1","15":"1","16":"0","17":"0"},{"1":"141","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"1","11":"0","12":"0","13":"0","14":"1","15":"1","16":"0","17":"1"},{"1":"140","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"1","11":"0","12":"0","13":"0","14":"1","15":"1","16":"0","17":"0"},{"1":"8204","2":"0","3":"0","4":"1","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"1","16":"0","17":"0"},{"1":"40972","2":"1","3":"0","4":"1","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"1","16":"0","17":"0"},{"1":"8266","2":"0","3":"0","4":"1","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"1","12":"0","13":"0","14":"1","15":"0","16":"1","17":"0"},{"1":"137","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"1","11":"0","12":"0","13":"0","14":"1","15":"0","16":"0","17":"1"},{"1":"1290","2":"0","3":"0","4":"0","5":"0","6":"0","7":"1","8":"0","9":"1","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"1","17":"0"},{"1":"74","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"1","12":"0","13":"0","14":"1","15":"0","16":"1","17":"0"},{"1":"1800","2":"0","3":"0","4":"0","5":"0","6":"0","7":"1","8":"1","9":"1","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"0","17":"0"},{"1":"32780","2":"1","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"1","16":"0","17":"0"},{"1":"5896","2":"0","3":"0","4":"0","5":"1","6":"0","7":"1","8":"1","9":"1","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"0","17":"0"},{"1":"40968","2":"1","3":"0","4":"1","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"0","17":"0"},{"1":"205","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"1","11":"1","12":"0","13":"0","14":"1","15":"1","16":"0","17":"1"},{"1":"202","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"1","11":"1","12":"0","13":"0","14":"1","15":"0","16":"1","17":"0"},{"1":"201","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"1","11":"1","12":"0","13":"0","14":"1","15":"0","16":"0","17":"1"},{"1":"8329","2":"0","3":"0","4":"1","5":"0","6":"0","7":"0","8":"0","9":"0","10":"1","11":"0","12":"0","13":"0","14":"1","15":"0","16":"0","17":"1"},{"1":"8270","2":"0","3":"0","4":"1","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"1","12":"0","13":"0","14":"1","15":"1","16":"1","17":"0"},{"1":"5385","2":"0","3":"0","4":"0","5":"1","6":"0","7":"1","8":"0","9":"1","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"0","17":"1"},{"1":"5898","2":"0","3":"0","4":"0","5":"1","6":"0","7":"1","8":"1","9":"1","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"1","17":"0"},{"1":"5642","2":"0","3":"0","4":"0","5":"1","6":"0","7":"1","8":"1","9":"0","10":"0","11":"0","12":"0","13":"0","14":"1","15":"0","16":"1","17":"0"},{"1":"1131675649","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"0","11":"0","12":"0","13":"0","14":"0","15":"0","16":"0","17":"1"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
</section>
<section id="create-function-for-bit-string-conversion" class="level1">
<h1>Create function for bit string conversion</h1>
<p>At this point I have the skeleton of the code needed to create a function to be applied to the next variables. It has to take into account the variable and the number of bits to be used in the bit mask conversion.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># Transform this to a function</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>obtain_bit_qc_df <span class="ot">&lt;-</span> <span class="cf">function</span>(variable, bits) {</span>
<span id="cb26-3"><a href="#cb26-3"></a>  </span>
<span id="cb26-4"><a href="#cb26-4"></a>  <span class="do">## Check unique values and add one validation (from the video)</span></span>
<span id="cb26-5"><a href="#cb26-5"></a>  qc_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">qc_ints =</span> <span class="fu">c</span>(<span class="fu">unique</span>(reflectance_500[[variable]]),</span>
<span id="cb26-6"><a href="#cb26-6"></a>                                    <span class="dv">1131675649</span>))</span>
<span id="cb26-7"><a href="#cb26-7"></a>  </span>
<span id="cb26-8"><a href="#cb26-8"></a>  <span class="do">## Create empty data frame. This case is 32 given that the variable</span></span>
<span id="cb26-9"><a href="#cb26-9"></a>  <span class="do">## `qc_500m` have 32 bits</span></span>
<span id="cb26-10"><a href="#cb26-10"></a>  total_bits <span class="ot">=</span> bits <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb26-11"><a href="#cb26-11"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(total_bits<span class="sc">:</span><span class="dv">0</span>)) {</span>
<span id="cb26-12"><a href="#cb26-12"></a>    qc_data[, <span class="fu">paste0</span>(<span class="st">"bit_"</span>, i)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb26-13"><a href="#cb26-13"></a>  }</span>
<span id="cb26-14"><a href="#cb26-14"></a>  </span>
<span id="cb26-15"><a href="#cb26-15"></a>  <span class="co"># Loop for obtaining bit string from unique values in the variable</span></span>
<span id="cb26-16"><a href="#cb26-16"></a>  bit_col <span class="ot">&lt;-</span> bits <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb26-17"><a href="#cb26-17"></a>  z <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb26-18"><a href="#cb26-18"></a>  <span class="cf">for</span> (i <span class="cf">in</span> qc_data<span class="sc">$</span>qc_ints) {</span>
<span id="cb26-19"><a href="#cb26-19"></a>    <span class="co"># print(i)</span></span>
<span id="cb26-20"><a href="#cb26-20"></a>    transformed <span class="ot">&lt;-</span> <span class="fu">as.integer</span>(<span class="fu">intToBits</span>(i)[<span class="dv">1</span><span class="sc">:</span>bits])</span>
<span id="cb26-21"><a href="#cb26-21"></a>    qc_data[z, <span class="dv">2</span><span class="sc">:</span>bit_col] <span class="ot">&lt;-</span> transformed[bits<span class="sc">:</span><span class="dv">1</span>]</span>
<span id="cb26-22"><a href="#cb26-22"></a>    z <span class="ot">&lt;-</span> z <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb26-23"><a href="#cb26-23"></a>  }</span>
<span id="cb26-24"><a href="#cb26-24"></a> </span>
<span id="cb26-25"><a href="#cb26-25"></a>  <span class="do">## Create test according to value in video</span></span>
<span id="cb26-26"><a href="#cb26-26"></a>  final_bit <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">"bit_"</span>, total_bits)</span>
<span id="cb26-27"><a href="#cb26-27"></a>  </span>
<span id="cb26-28"><a href="#cb26-28"></a>  process_test <span class="ot">&lt;-</span> qc_data <span class="sc">|&gt;</span> </span>
<span id="cb26-29"><a href="#cb26-29"></a>    <span class="fu">filter</span>(qc_ints <span class="sc">==</span> <span class="dv">1131675649</span>) <span class="sc">|&gt;</span></span>
<span id="cb26-30"><a href="#cb26-30"></a>    <span class="fu">select</span>(<span class="sc">-</span>qc_ints) <span class="sc">|&gt;</span></span>
<span id="cb26-31"><a href="#cb26-31"></a>    <span class="fu">unite</span>(<span class="at">col =</span> <span class="st">"new"</span>, <span class="fu">everything</span>(), <span class="at">sep =</span> <span class="st">""</span>) <span class="sc">|&gt;</span> </span>
<span id="cb26-32"><a href="#cb26-32"></a>    <span class="fu">pull</span>() </span>
<span id="cb26-33"><a href="#cb26-33"></a>  </span>
<span id="cb26-34"><a href="#cb26-34"></a>  test_object <span class="ot">&lt;-</span> stringr<span class="sc">::</span><span class="fu">str_sub</span>(<span class="st">"01000011011101000000000000000001"</span>,</span>
<span id="cb26-35"><a href="#cb26-35"></a>                                  <span class="at">start =</span> <span class="sc">-</span>bits, <span class="at">end =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb26-36"><a href="#cb26-36"></a></span>
<span id="cb26-37"><a href="#cb26-37"></a>  <span class="fu">stopifnot</span>(process_test <span class="sc">==</span> test_object) </span>
<span id="cb26-38"><a href="#cb26-38"></a>  </span>
<span id="cb26-39"><a href="#cb26-39"></a>  <span class="fu">return</span>(qc_data)</span>
<span id="cb26-40"><a href="#cb26-40"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s use the function on the <code>state_1km</code> variable to check if it works. Then, let’s compare the result with the dataset we create step by step to validate if we can obtain the same result.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># Obtain the bit string using the function</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>qc_data_function <span class="ot">&lt;-</span> <span class="fu">obtain_bit_qc_df</span>(<span class="at">variable =</span> <span class="st">"state_1km"</span>, <span class="at">bits =</span> <span class="dv">16</span>)</span>
<span id="cb27-3"><a href="#cb27-3"></a></span>
<span id="cb27-4"><a href="#cb27-4"></a><span class="co"># Compare last qc_data from state_1km and new qc_data created with function</span></span>
<span id="cb27-5"><a href="#cb27-5"></a><span class="fu">stopifnot</span>(qc_data<span class="sc">$</span>bit_14 <span class="sc">==</span> qc_data_function<span class="sc">$</span>bit_14)</span>
<span id="cb27-6"><a href="#cb27-6"></a></span>
<span id="cb27-7"><a href="#cb27-7"></a><span class="co"># Check dimensions</span></span>
<span id="cb27-8"><a href="#cb27-8"></a><span class="fu">stopifnot</span>(<span class="fu">dim</span>(qc_data) <span class="sc">==</span> <span class="fu">dim</span>(qc_data_function))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Seems that it works! With the function we obtained the same dimensions of the dataset than before. Let’s now create the categories for each of the bit strings</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="co"># Create the categories according to documentation</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>state_1km__description <span class="ot">&lt;-</span> qc_data_function <span class="sc">|&gt;</span> </span>
<span id="cb28-3"><a href="#cb28-3"></a>  <span class="fu">unite</span>(<span class="at">col =</span> <span class="st">"cloud_state"</span>, <span class="fu">c</span>(<span class="st">"bit_1"</span>, <span class="st">"bit_0"</span>), <span class="at">sep =</span> <span class="st">""</span>) <span class="sc">|&gt;</span> </span>
<span id="cb28-4"><a href="#cb28-4"></a>  <span class="fu">unite</span>(<span class="at">col =</span> <span class="st">"land_water_flag"</span>,</span>
<span id="cb28-5"><a href="#cb28-5"></a>        <span class="fu">c</span>(<span class="st">"bit_5"</span>, <span class="st">"bit_4"</span>, <span class="st">"bit_3"</span>), <span class="at">sep =</span> <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb28-6"><a href="#cb28-6"></a>  <span class="fu">unite</span>(<span class="at">col =</span> <span class="st">"aerosol_quantity"</span>,</span>
<span id="cb28-7"><a href="#cb28-7"></a>        <span class="fu">c</span>(<span class="st">"bit_7"</span>, <span class="st">"bit_6"</span>), <span class="at">sep =</span> <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb28-8"><a href="#cb28-8"></a>  <span class="fu">unite</span>(<span class="at">col =</span> <span class="st">"cirrus_detected"</span>,</span>
<span id="cb28-9"><a href="#cb28-9"></a>        <span class="fu">c</span>(<span class="st">"bit_9"</span>, <span class="st">"bit_8"</span>), <span class="at">sep =</span> <span class="st">""</span>) <span class="sc">|&gt;</span></span>
<span id="cb28-10"><a href="#cb28-10"></a>  <span class="fu">mutate</span>(<span class="at">cloud_state_qa =</span> <span class="fu">case_when</span>(</span>
<span id="cb28-11"><a href="#cb28-11"></a>    cloud_state <span class="sc">==</span> <span class="st">"00"</span> <span class="sc">~</span> <span class="st">"clear"</span>,</span>
<span id="cb28-12"><a href="#cb28-12"></a>    cloud_state <span class="sc">==</span> <span class="st">"01"</span> <span class="sc">~</span> <span class="st">"cloudy"</span>,</span>
<span id="cb28-13"><a href="#cb28-13"></a>    cloud_state <span class="sc">==</span> <span class="st">"10"</span> <span class="sc">~</span> <span class="st">"mixed"</span>,</span>
<span id="cb28-14"><a href="#cb28-14"></a>    cloud_state <span class="sc">==</span> <span class="st">"11"</span> <span class="sc">~</span> <span class="st">"not set, assumed clear"</span>,</span>
<span id="cb28-15"><a href="#cb28-15"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"No info, please validate bit conversion"</span></span>
<span id="cb28-16"><a href="#cb28-16"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb28-17"><a href="#cb28-17"></a>  <span class="fu">mutate</span>(<span class="at">cloud_shadow_qa =</span> <span class="fu">ifelse</span>(bit_2 <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"yes"</span>, <span class="st">"no"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb28-18"><a href="#cb28-18"></a>    <span class="fu">mutate</span>(<span class="at">land_water_qa =</span> <span class="fu">case_when</span>(</span>
<span id="cb28-19"><a href="#cb28-19"></a>    land_water_flag <span class="sc">==</span> <span class="st">"000"</span> <span class="sc">~</span> <span class="st">"shallow ocean"</span>,</span>
<span id="cb28-20"><a href="#cb28-20"></a>    land_water_flag <span class="sc">==</span> <span class="st">"001"</span> <span class="sc">~</span> <span class="st">"land"</span>,</span>
<span id="cb28-21"><a href="#cb28-21"></a>    land_water_flag <span class="sc">==</span> <span class="st">"010"</span> <span class="sc">~</span> <span class="st">"ocean coastlines and lake shorelines"</span>,</span>
<span id="cb28-22"><a href="#cb28-22"></a>    land_water_flag <span class="sc">==</span> <span class="st">"011"</span> <span class="sc">~</span> <span class="st">"shallow inland water"</span>,</span>
<span id="cb28-23"><a href="#cb28-23"></a>    land_water_flag <span class="sc">==</span> <span class="st">"100"</span> <span class="sc">~</span> <span class="st">"ephemeral water"</span>,</span>
<span id="cb28-24"><a href="#cb28-24"></a>    land_water_flag <span class="sc">==</span> <span class="st">"101"</span> <span class="sc">~</span> <span class="st">"deep inland water"</span>,</span>
<span id="cb28-25"><a href="#cb28-25"></a>    land_water_flag <span class="sc">==</span> <span class="st">"110"</span> <span class="sc">~</span> <span class="st">"continental/moderate ocean"</span>,</span>
<span id="cb28-26"><a href="#cb28-26"></a>    land_water_flag <span class="sc">==</span> <span class="st">"111"</span> <span class="sc">~</span> <span class="st">"deep ocean"</span>,</span>
<span id="cb28-27"><a href="#cb28-27"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"No info, please validate bit conversion"</span></span>
<span id="cb28-28"><a href="#cb28-28"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb28-29"><a href="#cb28-29"></a>    <span class="fu">mutate</span>(<span class="at">aerosol_quantity_qa =</span> <span class="fu">case_when</span>(</span>
<span id="cb28-30"><a href="#cb28-30"></a>    aerosol_quantity <span class="sc">==</span> <span class="st">"00"</span> <span class="sc">~</span> <span class="st">"climatology"</span>,</span>
<span id="cb28-31"><a href="#cb28-31"></a>    aerosol_quantity <span class="sc">==</span> <span class="st">"01"</span> <span class="sc">~</span> <span class="st">"low"</span>,</span>
<span id="cb28-32"><a href="#cb28-32"></a>    aerosol_quantity <span class="sc">==</span> <span class="st">"10"</span> <span class="sc">~</span> <span class="st">"average"</span>,</span>
<span id="cb28-33"><a href="#cb28-33"></a>    aerosol_quantity <span class="sc">==</span> <span class="st">"11"</span> <span class="sc">~</span> <span class="st">"high"</span>,</span>
<span id="cb28-34"><a href="#cb28-34"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"No info, please validate bit conversion"</span></span>
<span id="cb28-35"><a href="#cb28-35"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb28-36"><a href="#cb28-36"></a>    <span class="fu">mutate</span>(<span class="at">cirrus_detected_qa =</span> <span class="fu">case_when</span>(</span>
<span id="cb28-37"><a href="#cb28-37"></a>    cirrus_detected <span class="sc">==</span> <span class="st">"00"</span> <span class="sc">~</span> <span class="st">"none"</span>,</span>
<span id="cb28-38"><a href="#cb28-38"></a>    cirrus_detected <span class="sc">==</span> <span class="st">"01"</span> <span class="sc">~</span> <span class="st">"small"</span>,</span>
<span id="cb28-39"><a href="#cb28-39"></a>    cirrus_detected <span class="sc">==</span> <span class="st">"10"</span> <span class="sc">~</span> <span class="st">"average"</span>,</span>
<span id="cb28-40"><a href="#cb28-40"></a>    cirrus_detected <span class="sc">==</span> <span class="st">"11"</span> <span class="sc">~</span> <span class="st">"high"</span>,</span>
<span id="cb28-41"><a href="#cb28-41"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"No info, please validate bit conversion"</span></span>
<span id="cb28-42"><a href="#cb28-42"></a>  )) <span class="sc">|&gt;</span> </span>
<span id="cb28-43"><a href="#cb28-43"></a>  <span class="fu">mutate</span>(<span class="at">cloud_flag_qa =</span> <span class="fu">ifelse</span>(bit_10 <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"cloud"</span>, <span class="st">"no cloud"</span>),</span>
<span id="cb28-44"><a href="#cb28-44"></a>         <span class="at">fire_flag_qa =</span> <span class="fu">ifelse</span>(bit_11 <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"fire"</span>, <span class="st">"no fire"</span>),</span>
<span id="cb28-45"><a href="#cb28-45"></a>         <span class="at">snow_ice_flag_qa =</span> <span class="fu">ifelse</span>(bit_12 <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"yes"</span>, <span class="st">"no"</span>),</span>
<span id="cb28-46"><a href="#cb28-46"></a>         <span class="at">pixel_adjacent_cloud_qa =</span> <span class="fu">ifelse</span>(bit_13 <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"yes"</span>, <span class="st">"no"</span>),</span>
<span id="cb28-47"><a href="#cb28-47"></a>         <span class="at">salt_pan_qa =</span> <span class="fu">ifelse</span>(bit_14 <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"yes"</span>, <span class="st">"no"</span>),</span>
<span id="cb28-48"><a href="#cb28-48"></a>         <span class="at">snow_mask_qa =</span> <span class="fu">ifelse</span>(bit_15 <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"yes"</span>, <span class="st">"no"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, let’s check the resulting dataset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a>state_1km__description <span class="sc">|&gt;</span> </span>
<span id="cb29-2"><a href="#cb29-2"></a>        <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">"bit"</span>)) <span class="sc">|&gt;</span> </span>
<span id="cb29-3"><a href="#cb29-3"></a>        <span class="fu">paged_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["qc_ints"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["cirrus_detected"],"name":[2],"type":["chr"],"align":["left"]},{"label":["aerosol_quantity"],"name":[3],"type":["chr"],"align":["left"]},{"label":["land_water_flag"],"name":[4],"type":["chr"],"align":["left"]},{"label":["cloud_state"],"name":[5],"type":["chr"],"align":["left"]},{"label":["cloud_state_qa"],"name":[6],"type":["chr"],"align":["left"]},{"label":["cloud_shadow_qa"],"name":[7],"type":["chr"],"align":["left"]},{"label":["land_water_qa"],"name":[8],"type":["chr"],"align":["left"]},{"label":["aerosol_quantity_qa"],"name":[9],"type":["chr"],"align":["left"]},{"label":["cirrus_detected_qa"],"name":[10],"type":["chr"],"align":["left"]},{"label":["cloud_flag_qa"],"name":[11],"type":["chr"],"align":["left"]},{"label":["fire_flag_qa"],"name":[12],"type":["chr"],"align":["left"]},{"label":["snow_ice_flag_qa"],"name":[13],"type":["chr"],"align":["left"]},{"label":["pixel_adjacent_cloud_qa"],"name":[14],"type":["chr"],"align":["left"]},{"label":["salt_pan_qa"],"name":[15],"type":["chr"],"align":["left"]},{"label":["snow_mask_qa"],"name":[16],"type":["chr"],"align":["left"]}],"data":[{"1":"1033","2":"00","3":"00","4":"001","5":"01","6":"cloudy","7":"no","8":"land","9":"climatology","10":"none","11":"cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"40969","2":"00","3":"00","4":"001","5":"01","6":"cloudy","7":"no","8":"land","9":"climatology","10":"none","11":"no cloud","12":"no fire","13":"no","14":"yes","15":"no","16":"yes"},{"1":"8392","2":"00","3":"11","4":"001","5":"00","6":"clear","7":"no","8":"land","9":"high","10":"none","11":"no cloud","12":"no fire","13":"no","14":"yes","15":"no","16":"no"},{"1":"1034","2":"00","3":"00","4":"001","5":"10","6":"mixed","7":"no","8":"land","9":"climatology","10":"none","11":"cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"40970","2":"00","3":"00","4":"001","5":"10","6":"mixed","7":"no","8":"land","9":"climatology","10":"none","11":"no cloud","12":"no fire","13":"no","14":"yes","15":"no","16":"yes"},{"1":"5384","2":"01","3":"00","4":"001","5":"00","6":"clear","7":"no","8":"land","9":"climatology","10":"small","11":"cloud","12":"no fire","13":"yes","14":"no","15":"no","16":"no"},{"1":"1289","2":"01","3":"00","4":"001","5":"01","6":"cloudy","7":"no","8":"land","9":"climatology","10":"small","11":"cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"1801","2":"11","3":"00","4":"001","5":"01","6":"cloudy","7":"no","8":"land","9":"climatology","10":"high","11":"cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"45068","2":"00","3":"00","4":"001","5":"00","6":"clear","7":"yes","8":"land","9":"climatology","10":"none","11":"no cloud","12":"no fire","13":"yes","14":"yes","15":"no","16":"yes"},{"1":"1545","2":"10","3":"00","4":"001","5":"01","6":"cloudy","7":"no","8":"land","9":"climatology","10":"average","11":"cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"8397","2":"00","3":"11","4":"001","5":"01","6":"cloudy","7":"yes","8":"land","9":"high","10":"none","11":"no cloud","12":"no fire","13":"no","14":"yes","15":"no","16":"no"},{"1":"8398","2":"00","3":"11","4":"001","5":"10","6":"mixed","7":"yes","8":"land","9":"high","10":"none","11":"no cloud","12":"no fire","13":"no","14":"yes","15":"no","16":"no"},{"1":"1032","2":"00","3":"00","4":"001","5":"00","6":"clear","7":"no","8":"land","9":"climatology","10":"none","11":"cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"8396","2":"00","3":"11","4":"001","5":"00","6":"clear","7":"yes","8":"land","9":"high","10":"none","11":"no cloud","12":"no fire","13":"no","14":"yes","15":"no","16":"no"},{"1":"8393","2":"00","3":"11","4":"001","5":"01","6":"cloudy","7":"no","8":"land","9":"high","10":"none","11":"no cloud","12":"no fire","13":"no","14":"yes","15":"no","16":"no"},{"1":"5128","2":"00","3":"00","4":"001","5":"00","6":"clear","7":"no","8":"land","9":"climatology","10":"none","11":"cloud","12":"no fire","13":"yes","14":"no","15":"no","16":"no"},{"1":"40973","2":"00","3":"00","4":"001","5":"01","6":"cloudy","7":"yes","8":"land","9":"climatology","10":"none","11":"no cloud","12":"no fire","13":"no","14":"yes","15":"no","16":"yes"},{"1":"40974","2":"00","3":"00","4":"001","5":"10","6":"mixed","7":"yes","8":"land","9":"climatology","10":"none","11":"no cloud","12":"no fire","13":"no","14":"yes","15":"no","16":"yes"},{"1":"45064","2":"00","3":"00","4":"001","5":"00","6":"clear","7":"no","8":"land","9":"climatology","10":"none","11":"no cloud","12":"no fire","13":"yes","14":"yes","15":"no","16":"yes"},{"1":"8394","2":"00","3":"11","4":"001","5":"10","6":"mixed","7":"no","8":"land","9":"high","10":"none","11":"no cloud","12":"no fire","13":"no","14":"yes","15":"no","16":"no"},{"1":"32781","2":"00","3":"00","4":"001","5":"01","6":"cloudy","7":"yes","8":"land","9":"climatology","10":"none","11":"no cloud","12":"no fire","13":"no","14":"no","15":"no","16":"yes"},{"1":"206","2":"00","3":"11","4":"001","5":"10","6":"mixed","7":"yes","8":"land","9":"high","10":"none","11":"no cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"36872","2":"00","3":"00","4":"001","5":"00","6":"clear","7":"no","8":"land","9":"climatology","10":"none","11":"no cloud","12":"no fire","13":"yes","14":"no","15":"no","16":"yes"},{"1":"32778","2":"00","3":"00","4":"001","5":"10","6":"mixed","7":"no","8":"land","9":"climatology","10":"none","11":"no cloud","12":"no fire","13":"no","14":"no","15":"no","16":"yes"},{"1":"32777","2":"00","3":"00","4":"001","5":"01","6":"cloudy","7":"no","8":"land","9":"climatology","10":"none","11":"no cloud","12":"no fire","13":"no","14":"no","15":"no","16":"yes"},{"1":"5640","2":"10","3":"00","4":"001","5":"00","6":"clear","7":"no","8":"land","9":"climatology","10":"average","11":"cloud","12":"no fire","13":"yes","14":"no","15":"no","16":"no"},{"1":"36876","2":"00","3":"00","4":"001","5":"00","6":"clear","7":"yes","8":"land","9":"climatology","10":"none","11":"no cloud","12":"no fire","13":"yes","14":"no","15":"no","16":"yes"},{"1":"32776","2":"00","3":"00","4":"001","5":"00","6":"clear","7":"no","8":"land","9":"climatology","10":"none","11":"no cloud","12":"no fire","13":"no","14":"no","15":"no","16":"yes"},{"1":"45066","2":"00","3":"00","4":"001","5":"10","6":"mixed","7":"no","8":"land","9":"climatology","10":"none","11":"no cloud","12":"no fire","13":"yes","14":"yes","15":"no","16":"yes"},{"1":"8334","2":"00","3":"10","4":"001","5":"10","6":"mixed","7":"yes","8":"land","9":"average","10":"none","11":"no cloud","12":"no fire","13":"no","14":"yes","15":"no","16":"no"},{"1":"200","2":"00","3":"11","4":"001","5":"00","6":"clear","7":"no","8":"land","9":"high","10":"none","11":"no cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"138","2":"00","3":"10","4":"001","5":"10","6":"mixed","7":"no","8":"land","9":"average","10":"none","11":"no cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"136","2":"00","3":"10","4":"001","5":"00","6":"clear","7":"no","8":"land","9":"average","10":"none","11":"no cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"8","2":"00","3":"00","4":"001","5":"00","6":"clear","7":"no","8":"land","9":"climatology","10":"none","11":"no cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"72","2":"00","3":"01","4":"001","5":"00","6":"clear","7":"no","8":"land","9":"low","10":"none","11":"no cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"8264","2":"00","3":"01","4":"001","5":"00","6":"clear","7":"no","8":"land","9":"low","10":"none","11":"no cloud","12":"no fire","13":"no","14":"yes","15":"no","16":"no"},{"1":"1544","2":"10","3":"00","4":"001","5":"00","6":"clear","7":"no","8":"land","9":"climatology","10":"average","11":"cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"8332","2":"00","3":"10","4":"001","5":"00","6":"clear","7":"yes","8":"land","9":"average","10":"none","11":"no cloud","12":"no fire","13":"no","14":"yes","15":"no","16":"no"},{"1":"1802","2":"11","3":"00","4":"001","5":"10","6":"mixed","7":"no","8":"land","9":"climatology","10":"high","11":"cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"1288","2":"01","3":"00","4":"001","5":"00","6":"clear","7":"no","8":"land","9":"climatology","10":"small","11":"cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"8328","2":"00","3":"10","4":"001","5":"00","6":"clear","7":"no","8":"land","9":"average","10":"none","11":"no cloud","12":"no fire","13":"no","14":"yes","15":"no","16":"no"},{"1":"1546","2":"10","3":"00","4":"001","5":"10","6":"mixed","7":"no","8":"land","9":"climatology","10":"average","11":"cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"8268","2":"00","3":"01","4":"001","5":"00","6":"clear","7":"yes","8":"land","9":"low","10":"none","11":"no cloud","12":"no fire","13":"no","14":"yes","15":"no","16":"no"},{"1":"8330","2":"00","3":"10","4":"001","5":"10","6":"mixed","7":"no","8":"land","9":"average","10":"none","11":"no cloud","12":"no fire","13":"no","14":"yes","15":"no","16":"no"},{"1":"8205","2":"00","3":"00","4":"001","5":"01","6":"cloudy","7":"yes","8":"land","9":"climatology","10":"none","11":"no cloud","12":"no fire","13":"no","14":"yes","15":"no","16":"no"},{"1":"76","2":"00","3":"01","4":"001","5":"00","6":"clear","7":"yes","8":"land","9":"low","10":"none","11":"no cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"204","2":"00","3":"11","4":"001","5":"00","6":"clear","7":"yes","8":"land","9":"high","10":"none","11":"no cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"141","2":"00","3":"10","4":"001","5":"01","6":"cloudy","7":"yes","8":"land","9":"average","10":"none","11":"no cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"140","2":"00","3":"10","4":"001","5":"00","6":"clear","7":"yes","8":"land","9":"average","10":"none","11":"no cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"8204","2":"00","3":"00","4":"001","5":"00","6":"clear","7":"yes","8":"land","9":"climatology","10":"none","11":"no cloud","12":"no fire","13":"no","14":"yes","15":"no","16":"no"},{"1":"40972","2":"00","3":"00","4":"001","5":"00","6":"clear","7":"yes","8":"land","9":"climatology","10":"none","11":"no cloud","12":"no fire","13":"no","14":"yes","15":"no","16":"yes"},{"1":"8266","2":"00","3":"01","4":"001","5":"10","6":"mixed","7":"no","8":"land","9":"low","10":"none","11":"no cloud","12":"no fire","13":"no","14":"yes","15":"no","16":"no"},{"1":"137","2":"00","3":"10","4":"001","5":"01","6":"cloudy","7":"no","8":"land","9":"average","10":"none","11":"no cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"1290","2":"01","3":"00","4":"001","5":"10","6":"mixed","7":"no","8":"land","9":"climatology","10":"small","11":"cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"74","2":"00","3":"01","4":"001","5":"10","6":"mixed","7":"no","8":"land","9":"low","10":"none","11":"no cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"1800","2":"11","3":"00","4":"001","5":"00","6":"clear","7":"no","8":"land","9":"climatology","10":"high","11":"cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"32780","2":"00","3":"00","4":"001","5":"00","6":"clear","7":"yes","8":"land","9":"climatology","10":"none","11":"no cloud","12":"no fire","13":"no","14":"no","15":"no","16":"yes"},{"1":"5896","2":"11","3":"00","4":"001","5":"00","6":"clear","7":"no","8":"land","9":"climatology","10":"high","11":"cloud","12":"no fire","13":"yes","14":"no","15":"no","16":"no"},{"1":"40968","2":"00","3":"00","4":"001","5":"00","6":"clear","7":"no","8":"land","9":"climatology","10":"none","11":"no cloud","12":"no fire","13":"no","14":"yes","15":"no","16":"yes"},{"1":"205","2":"00","3":"11","4":"001","5":"01","6":"cloudy","7":"yes","8":"land","9":"high","10":"none","11":"no cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"202","2":"00","3":"11","4":"001","5":"10","6":"mixed","7":"no","8":"land","9":"high","10":"none","11":"no cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"201","2":"00","3":"11","4":"001","5":"01","6":"cloudy","7":"no","8":"land","9":"high","10":"none","11":"no cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"},{"1":"8329","2":"00","3":"10","4":"001","5":"01","6":"cloudy","7":"no","8":"land","9":"average","10":"none","11":"no cloud","12":"no fire","13":"no","14":"yes","15":"no","16":"no"},{"1":"8270","2":"00","3":"01","4":"001","5":"10","6":"mixed","7":"yes","8":"land","9":"low","10":"none","11":"no cloud","12":"no fire","13":"no","14":"yes","15":"no","16":"no"},{"1":"5385","2":"01","3":"00","4":"001","5":"01","6":"cloudy","7":"no","8":"land","9":"climatology","10":"small","11":"cloud","12":"no fire","13":"yes","14":"no","15":"no","16":"no"},{"1":"5898","2":"11","3":"00","4":"001","5":"10","6":"mixed","7":"no","8":"land","9":"climatology","10":"high","11":"cloud","12":"no fire","13":"yes","14":"no","15":"no","16":"no"},{"1":"5642","2":"10","3":"00","4":"001","5":"10","6":"mixed","7":"no","8":"land","9":"climatology","10":"average","11":"cloud","12":"no fire","13":"yes","14":"no","15":"no","16":"no"},{"1":"1131675649","2":"00","3":"00","4":"000","5":"01","6":"cloudy","7":"no","8":"shallow ocean","9":"climatology","10":"none","11":"no cloud","12":"no fire","13":"no","14":"no","15":"no","16":"no"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<section id="q_scan" class="level3">
<h3 class="anchored" data-anchor-id="q_scan">q_scan</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># Obtain the bit string</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>qc_data <span class="ot">&lt;-</span> <span class="fu">obtain_bit_qc_df</span>(<span class="at">variable =</span> <span class="st">"q_scan"</span>, <span class="at">bits =</span> <span class="dv">8</span>)</span>
<span id="cb30-3"><a href="#cb30-3"></a></span>
<span id="cb30-4"><a href="#cb30-4"></a><span class="co"># Create the categories according to documentation</span></span>
<span id="cb30-5"><a href="#cb30-5"></a>q_scan_description <span class="ot">&lt;-</span> qc_data <span class="sc">|&gt;</span> </span>
<span id="cb30-6"><a href="#cb30-6"></a>  <span class="fu">mutate</span>(<span class="at">scan_quadrant_1 =</span> <span class="fu">ifelse</span>(bit_0 <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"yes"</span>, <span class="st">"no"</span>),</span>
<span id="cb30-7"><a href="#cb30-7"></a>         <span class="at">scan_quadrant_2 =</span> <span class="fu">ifelse</span>(bit_0 <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"yes"</span>, <span class="st">"no"</span>),</span>
<span id="cb30-8"><a href="#cb30-8"></a>         <span class="at">scan_quadrant_3 =</span> <span class="fu">ifelse</span>(bit_0 <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"yes"</span>, <span class="st">"no"</span>),</span>
<span id="cb30-9"><a href="#cb30-9"></a>         <span class="at">scan_quadrant_4 =</span> <span class="fu">ifelse</span>(bit_0 <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"yes"</span>, <span class="st">"no"</span>),</span>
<span id="cb30-10"><a href="#cb30-10"></a>         <span class="at">missing_obs_1 =</span> <span class="fu">ifelse</span>(bit_1 <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"same"</span>, <span class="st">"different"</span>),</span>
<span id="cb30-11"><a href="#cb30-11"></a>         <span class="at">missing_obs_2 =</span> <span class="fu">ifelse</span>(bit_1 <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"same"</span>, <span class="st">"different"</span>),</span>
<span id="cb30-12"><a href="#cb30-12"></a>         <span class="at">missing_obs_3 =</span> <span class="fu">ifelse</span>(bit_1 <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"same"</span>, <span class="st">"different"</span>),</span>
<span id="cb30-13"><a href="#cb30-13"></a>         <span class="at">missing_obs_4 =</span> <span class="fu">ifelse</span>(bit_1 <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"same"</span>, <span class="st">"different"</span>))</span>
<span id="cb30-14"><a href="#cb30-14"></a></span>
<span id="cb30-15"><a href="#cb30-15"></a>q_scan_description <span class="sc">|&gt;</span> </span>
<span id="cb30-16"><a href="#cb30-16"></a>        <span class="fu">paged_table</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["qc_ints"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["bit_7"],"name":[2],"type":["int"],"align":["right"]},{"label":["bit_6"],"name":[3],"type":["int"],"align":["right"]},{"label":["bit_5"],"name":[4],"type":["int"],"align":["right"]},{"label":["bit_4"],"name":[5],"type":["int"],"align":["right"]},{"label":["bit_3"],"name":[6],"type":["int"],"align":["right"]},{"label":["bit_2"],"name":[7],"type":["int"],"align":["right"]},{"label":["bit_1"],"name":[8],"type":["int"],"align":["right"]},{"label":["bit_0"],"name":[9],"type":["int"],"align":["right"]},{"label":["scan_quadrant_1"],"name":[10],"type":["chr"],"align":["left"]},{"label":["scan_quadrant_2"],"name":[11],"type":["chr"],"align":["left"]},{"label":["scan_quadrant_3"],"name":[12],"type":["chr"],"align":["left"]},{"label":["scan_quadrant_4"],"name":[13],"type":["chr"],"align":["left"]},{"label":["missing_obs_1"],"name":[14],"type":["chr"],"align":["left"]},{"label":["missing_obs_2"],"name":[15],"type":["chr"],"align":["left"]},{"label":["missing_obs_3"],"name":[16],"type":["chr"],"align":["left"]},{"label":["missing_obs_4"],"name":[17],"type":["chr"],"align":["left"]}],"data":[{"1":"14","2":"0","3":"0","4":"0","5":"0","6":"1","7":"1","8":"1","9":"0","10":"no","11":"no","12":"no","13":"no","14":"same","15":"same","16":"same","17":"same"},{"1":"8","2":"0","3":"0","4":"0","5":"0","6":"1","7":"0","8":"0","9":"0","10":"no","11":"no","12":"no","13":"no","14":"different","15":"different","16":"different","17":"different"},{"1":"9","2":"0","3":"0","4":"0","5":"0","6":"1","7":"0","8":"0","9":"1","10":"yes","11":"yes","12":"yes","13":"yes","14":"different","15":"different","16":"different","17":"different"},{"1":"2","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"1","9":"0","10":"no","11":"no","12":"no","13":"no","14":"same","15":"same","16":"same","17":"same"},{"1":"0","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"0","10":"no","11":"no","12":"no","13":"no","14":"different","15":"different","16":"different","17":"different"},{"1":"6","2":"0","3":"0","4":"0","5":"0","6":"0","7":"1","8":"1","9":"0","10":"no","11":"no","12":"no","13":"no","14":"same","15":"same","16":"same","17":"same"},{"1":"15","2":"0","3":"0","4":"0","5":"0","6":"1","7":"1","8":"1","9":"1","10":"yes","11":"yes","12":"yes","13":"yes","14":"same","15":"same","16":"same","17":"same"},{"1":"3","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"1","9":"1","10":"yes","11":"yes","12":"yes","13":"yes","14":"same","15":"same","16":"same","17":"same"},{"1":"13","2":"0","3":"0","4":"0","5":"0","6":"1","7":"1","8":"0","9":"1","10":"yes","11":"yes","12":"yes","13":"yes","14":"different","15":"different","16":"different","17":"different"},{"1":"11","2":"0","3":"0","4":"0","5":"0","6":"1","7":"0","8":"1","9":"1","10":"yes","11":"yes","12":"yes","13":"yes","14":"same","15":"same","16":"same","17":"same"},{"1":"12","2":"0","3":"0","4":"0","5":"0","6":"1","7":"1","8":"0","9":"0","10":"no","11":"no","12":"no","13":"no","14":"different","15":"different","16":"different","17":"different"},{"1":"1","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"1","10":"yes","11":"yes","12":"yes","13":"yes","14":"different","15":"different","16":"different","17":"different"},{"1":"7","2":"0","3":"0","4":"0","5":"0","6":"0","7":"1","8":"1","9":"1","10":"yes","11":"yes","12":"yes","13":"yes","14":"same","15":"same","16":"same","17":"same"},{"1":"10","2":"0","3":"0","4":"0","5":"0","6":"1","7":"0","8":"1","9":"0","10":"no","11":"no","12":"no","13":"no","14":"same","15":"same","16":"same","17":"same"},{"1":"5","2":"0","3":"0","4":"0","5":"0","6":"0","7":"1","8":"0","9":"1","10":"yes","11":"yes","12":"yes","13":"yes","14":"different","15":"different","16":"different","17":"different"},{"1":"4","2":"0","3":"0","4":"0","5":"0","6":"0","7":"1","8":"0","9":"0","10":"no","11":"no","12":"no","13":"no","14":"different","15":"different","16":"different","17":"different"},{"1":"1131675649","2":"0","3":"0","4":"0","5":"0","6":"0","7":"0","8":"0","9":"1","10":"yes","11":"yes","12":"yes","13":"yes","14":"different","15":"different","16":"different","17":"different"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
</section>
<section id="g_flags" class="level3">
<h3 class="anchored" data-anchor-id="g_flags">g_flags</h3>
<p>It looks that this variable have just the same value for every observation:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a><span class="fu">unique</span>(reflectance_500<span class="sc">$</span>gflags)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
<p>Given that I don’t have any values there other than 0, I’m not going to apply the function to this variable.</p>
</section>
</section>
<section id="conclusions-on-the-bit-conversion" class="level1">
<h1>Conclusions on the bit conversion</h1>
<ul>
<li>All steps and references are documented.</li>
<li>I created a function to do the bit mask conversion</li>
<li>Function will be exported to a new file and documented as a formal function in R to be used in the next steps for the data analysis.</li>
<li>After using the function, steps to include the correspondent categories according to the official MODIS documentation are needed.</li>
<li>The new data frames with the bit strings and the categories per each unique value will be used to filter the all the original observations from the datasets.</li>
</ul>
</section>
<section id="quality-filtering" class="level1">
<h1>Quality filtering</h1>
<p>Now that I have validated the function and I have per each of the variables with bit mask the categories obtained from the MODIS documentation, I can start with filtering out those pixels with low quality.</p>
<section id="select-bitmasks-categories-that-indicates-high-quality" class="level3">
<h3 class="anchored" data-anchor-id="select-bitmasks-categories-that-indicates-high-quality">Select bitmasks categories that indicates high quality</h3>
<ul>
<li>First I will start with <code>state_1km</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a><span class="co"># quality values from state_1km</span></span>
<span id="cb33-2"><a href="#cb33-2"></a><span class="co"># bit 6-7 and bit 13 can be anything as regarded by richard</span></span>
<span id="cb33-3"><a href="#cb33-3"></a>state_1km_highest_quality <span class="ot">&lt;-</span> state_1km__description <span class="sc">|&gt;</span></span>
<span id="cb33-4"><a href="#cb33-4"></a>  <span class="fu">filter</span>(cloud_state_qa <span class="sc">==</span> <span class="st">"clear"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb33-5"><a href="#cb33-5"></a>  <span class="fu">filter</span>(cloud_shadow_qa <span class="sc">==</span> <span class="st">"no"</span>) <span class="sc">|&gt;</span></span>
<span id="cb33-6"><a href="#cb33-6"></a>  <span class="fu">filter</span>(land_water_qa <span class="sc">==</span> <span class="st">"land"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb33-7"><a href="#cb33-7"></a>  <span class="fu">filter</span>(cirrus_detected_qa <span class="sc">==</span> <span class="st">"none"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb33-8"><a href="#cb33-8"></a>  <span class="fu">filter</span>(bit_10 <span class="sc">==</span> <span class="st">"0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb33-9"><a href="#cb33-9"></a>  <span class="fu">filter</span>(fire_flag_qa <span class="sc">==</span> <span class="st">"no fire"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb33-10"><a href="#cb33-10"></a>  <span class="fu">filter</span>(snow_ice_flag_qa <span class="sc">==</span> <span class="st">"no"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb33-11"><a href="#cb33-11"></a>  <span class="fu">filter</span>(bit_14 <span class="sc">==</span> <span class="st">"0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb33-12"><a href="#cb33-12"></a>  <span class="fu">filter</span>(bit_15 <span class="sc">==</span> <span class="st">"0"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb33-13"><a href="#cb33-13"></a>  <span class="fu">select</span>(qc_ints) <span class="sc">|&gt;</span> </span>
<span id="cb33-14"><a href="#cb33-14"></a>  <span class="fu">pull</span>()</span>
<span id="cb33-15"><a href="#cb33-15"></a></span>
<span id="cb33-16"><a href="#cb33-16"></a>state_1km_highest_quality</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8392  200  136    8   72 8264 8328</code></pre>
</div>
</div>
<ul>
<li>Filtering with <code>qc_500m</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># quality values from qc_500</span></span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="co"># All should be 0 for all of the bits, except for </span></span>
<span id="cb35-3"><a href="#cb35-3"></a>qc_500_highest_quality <span class="ot">&lt;-</span> qc_500_description <span class="sc">|&gt;</span></span>
<span id="cb35-4"><a href="#cb35-4"></a>  <span class="fu">filter</span>(modland_qa <span class="sc">==</span> <span class="st">"ideal quality - all bands"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-5"><a href="#cb35-5"></a>  <span class="fu">filter</span>(band1_qa <span class="sc">==</span> <span class="st">"highest_quality"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-6"><a href="#cb35-6"></a>  <span class="fu">filter</span>(band2_qa <span class="sc">==</span> <span class="st">"highest_quality"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-7"><a href="#cb35-7"></a>  <span class="fu">filter</span>(band3_qa <span class="sc">==</span> <span class="st">"highest_quality"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-8"><a href="#cb35-8"></a>  <span class="fu">filter</span>(band4_qa <span class="sc">==</span> <span class="st">"highest_quality"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-9"><a href="#cb35-9"></a>  <span class="fu">filter</span>(band5_qa <span class="sc">==</span> <span class="st">"highest_quality"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-10"><a href="#cb35-10"></a>  <span class="fu">filter</span>(band6_qa <span class="sc">==</span> <span class="st">"highest_quality"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-11"><a href="#cb35-11"></a>  <span class="fu">filter</span>(band7_qa <span class="sc">==</span> <span class="st">"highest_quality"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-12"><a href="#cb35-12"></a>  <span class="fu">filter</span>(atmospheric_correction <span class="sc">==</span> <span class="st">"yes"</span>) <span class="sc">|&gt;</span></span>
<span id="cb35-13"><a href="#cb35-13"></a>  <span class="co"># filter(adjacency_correction == "yes") |&gt; </span></span>
<span id="cb35-14"><a href="#cb35-14"></a>  <span class="fu">select</span>(qc_ints) <span class="sc">|&gt;</span> </span>
<span id="cb35-15"><a href="#cb35-15"></a>  <span class="fu">pull</span>()</span>
<span id="cb35-16"><a href="#cb35-16"></a></span>
<span id="cb35-17"><a href="#cb35-17"></a>qc_500_highest_quality</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1073741824</code></pre>
</div>
</div>
<ul>
<li>Filtering with q_scan</li>
</ul>
<p>From the meeting with Richard Fernandes, we agreed to leave this one out.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="co"># quality values from q_scan</span></span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="co"># This one is fine if I don't use it and let it be.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>Filtering with gflags</li>
</ul>
<p>For the <code>reflectance_500</code> dataset, we have the same value in all the observations</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="co"># quality values for gflags</span></span>
<span id="cb38-2"><a href="#cb38-2"></a><span class="co"># gflags_highest_quality &lt;- reflectance_500 |&gt;</span></span>
<span id="cb38-3"><a href="#cb38-3"></a><span class="co">#   filter(gflags == 0)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filter-from-complete-data-the-selected-bitmasks" class="level3">
<h3 class="anchored" data-anchor-id="filter-from-complete-data-the-selected-bitmasks">Filter from complete data the selected bitmasks</h3>
<p>So far, I have the bitmasks that indicates the highest quality, so I can filter out the rest from the <code>reflectance_500</code> dataset</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>state_1km_filter <span class="ot">&lt;-</span> reflectance_500 <span class="sc">|&gt;</span> </span>
<span id="cb39-2"><a href="#cb39-2"></a>  <span class="fu">filter</span>(state_1km <span class="sc">%in%</span> state_1km_highest_quality) <span class="sc">|&gt;</span> </span>
<span id="cb39-3"><a href="#cb39-3"></a>  <span class="fu">nrow</span>()</span>
<span id="cb39-4"><a href="#cb39-4"></a></span>
<span id="cb39-5"><a href="#cb39-5"></a>state_1km_filter</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4586</code></pre>
</div>
</div>
<p>Those number of observations represents just the filtering based on the <code>state_1km</code> variable. Now, I will continue with the <code>qc_500</code> variable:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>state_1km_filter_qc_500 <span class="ot">&lt;-</span> reflectance_500 <span class="sc">|&gt;</span> </span>
<span id="cb41-2"><a href="#cb41-2"></a>  <span class="fu">filter</span>(state_1km <span class="sc">%in%</span> state_1km_highest_quality) <span class="sc">|&gt;</span> </span>
<span id="cb41-3"><a href="#cb41-3"></a>  <span class="fu">filter</span>(qc_500m <span class="sc">%in%</span> qc_500_highest_quality) <span class="sc">|&gt;</span> </span>
<span id="cb41-4"><a href="#cb41-4"></a>  <span class="fu">nrow</span>()</span>
<span id="cb41-5"><a href="#cb41-5"></a></span>
<span id="cb41-6"><a href="#cb41-6"></a>state_1km_filter_qc_500</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4319</code></pre>
</div>
</div>
</section>
<section id="some-plots-with-clean-reflectance_500-data" class="level2">
<h2 class="anchored" data-anchor-id="some-plots-with-clean-reflectance_500-data">Some plots with clean reflectance_500 data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>reflectance_500 <span class="sc">|&gt;</span> </span>
<span id="cb43-2"><a href="#cb43-2"></a>  <span class="fu">filter</span>(state_1km <span class="sc">%in%</span> state_1km_highest_quality) <span class="sc">|&gt;</span> </span>
<span id="cb43-3"><a href="#cb43-3"></a>  <span class="fu">select</span>(date) <span class="sc">|&gt;</span> </span>
<span id="cb43-4"><a href="#cb43-4"></a>  <span class="co"># pull() |&gt; </span></span>
<span id="cb43-5"><a href="#cb43-5"></a>  <span class="fu">mutate</span>(<span class="at">year_month =</span> zoo<span class="sc">::</span><span class="fu">as.yearmon</span>(date)) <span class="sc">|&gt;</span> </span>
<span id="cb43-6"><a href="#cb43-6"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> date)) <span class="sc">+</span> </span>
<span id="cb43-7"><a href="#cb43-7"></a>  <span class="fu">geom_histogram</span>() <span class="sc">+</span></span>
<span id="cb43-8"><a href="#cb43-8"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_labels =</span> <span class="st">"%b%Y"</span>, <span class="at">breaks =</span> <span class="st">"months"</span>) <span class="sc">+</span></span>
<span id="cb43-9"><a href="#cb43-9"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">h =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb43-10"><a href="#cb43-10"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Date"</span>,</span>
<span id="cb43-11"><a href="#cb43-11"></a>       <span class="at">y =</span> <span class="st">"Number of pixels"</span>,</span>
<span id="cb43-12"><a href="#cb43-12"></a>       <span class="at">title =</span> <span class="st">"Borden  MODIS pixels per month after quality filtering"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="conclusion" class="level1">
<h1>Conclusion</h1>
<ul>
<li>Function <code>obtain_bit_qc_df()</code> can be used to do the bit string conversion</li>
<li>All steps are summarized in the function. Code here is just the historical reference. Functional and documented code for the function is in the <code>R/create_bit_string.R</code> file.</li>
<li>The code to create the human readable categories from the bit strings so that bad/high quality filtering of the pixels can be done in the analysis is in the <code>scripts/create_bitstrings_tables.R</code>.</li>
</ul>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div id="quarto-reuse" class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{a. hernandez mora2024,
  author = {A. Hernandez Mora, Ronny},
  title = {MODIS Pixel Bit Strings Conversion with {R}},
  date = {2024-05-01},
  url = {https://ronnyale.com//posts/2023-12-25-modis-bitstring},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-a. hernandez mora2024" class="csl-entry quarto-appendix-citeas" role="listitem">
A. Hernandez Mora, Ronny. 2024. <span>“MODIS Pixel Bit Strings
Conversion with R.”</span> May 1, 2024. <a href="https://ronnyale.com//posts/2023-12-25-modis-bitstring">https://ronnyale.com//posts/2023-12-25-modis-bitstring</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://ronnyale.com">ronnyale.com</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>