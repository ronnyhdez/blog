{
  "hash": "6193d21cb1054238b882370dd66f8f19",
  "result": {
    "markdown": "---\ntitle: \"Datos abiertos municipalidad de San José, Costa Rica\"\ndescription: |\n   Una introducción al uso del API de datos abiertos de la muni de San José\nauthor: \n  - name: \"Ronny A. Hernandez Mora\"\n    url: \"https://ronnyale.com\"\n  - name: Erick Calderón Morales\n    url: https://github.com/ecamo19\nformat:\n  html:\n    toc-title: Contents\n    toc: true\n    toc-depth: 3\n    toc-location: left\n    code-fold: true\n    code-summary: \"Show the code\"\neditor: visual\neditor_options: \n  chunk_output_type: console\n---\n\n::: {.cell}\n\n```{.r .cell-code}\n# ---\n# title: \"Datos abiertos municipalidad de San José, Costa Rica\"\n# description: |\n#   Una introducción al uso del API de datos abiertos de la muni de San José\n# author:\n#   - name: Ronny A. Hernández Mora\n#     url: http://ronnyhdez.rbind.io/\n#   - name: Erick Calderón Morales\n#     url: https://github.com/ecamo19\n# date: 2018-01-13 \n# creative_commons: CC BY-NC\n# preview: images/city.png\n# twitter:\n#   creator: \"@RonnyHdezM\"\n# output:\n#   distill::distill_article:\n#     self_contained: true\n# ---\n```\n:::\n\n\n\n\nGracias a la iniciativa de [Gobierno\nAbierto](http://www.gobiernoabierto.go.cr/) de Costa Rica tenemos la\nposibilidad de obtener datos de diferentes entes a través de la conexión\ncon API's.\n\nEsto nos da la posibilidad de no pasar por engorrosos procesos de\nlimpiar datos a partir de formatos casi imposibles como pdf's, .csv\nextravagantes u otros formatos difíciles de trabajar.\n\nEn este caso vamos a utilizar el lenguaje de programación R y el paquete\n[junr](https://cran.r-project.org/web/packages/junr/index.html) de\n[Frans van Dunné](https://github.com/FvD) para conectarnos al API de la\nmunicipalidad de San José y revisar qué datos se encuentran disponibles.\n\n### Obtener el API key de la municipalidad de San José\n\nEn la siguiente [dirección](http://datosabiertos.msj.go.cr/developers/)\npodrá encontrar el API key necesario para hacer el llamado.\n\nVamos a crear como objetos nuestras credenciales para hacer la conexión\nal API de la municipalidad de San José. El url que aparece acá es el que\nse debe de usar para conectarnos al sistema de la muni de San José. Si\nestán siguiendo ete ejemplo pueden escribir el mismo que aparece acá.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nurl_base <- \"http://api.datosabiertos.msj.go.cr/api/v2/datastreams/\"\napi_key <- SU_API_KEY\n```\n:::\n\n\n### Obtener el indice de las tablas\n\nYa que tenemos las credenciales listas (api key & url), vamos a revisar\nel índice de las tablas de datos que la municipalidad ha liberado:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Traemos el indice  de los datos que existen\nindice <- get_index(url_base, api_key = api_key)\n\n# Revisamos estructura del objeto \nglimpse(indice)\n\n## Observations: 257\n## Variables: 18\n## $ status          <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n## $ description     <chr> \"Valor absoluto y Tasa por 100.000 2006 - 2014\",…\n## $ parameters      <list> [[], [], [], [], [], [], [], [], [], [], [], []…\n## $ tags            <list> [<\"san jose\", \"municipalidad\", \"muertes violent…\n## $ timestamp       <dbl> 1.547586e+12, 1.539808e+12, 1.516222e+12, 1.5162…\n## $ created_at      <int> 1547586293, 1539744226, 1516221668, 1516220839, …\n## $ title           <chr> \"Cantidad y Tasa de muertes violentas\", \"Densida…\n## $ modified_at     <int> 1547586492, 1539808089, 1516221733, 1516221641, …\n## $ category_id     <chr> \"83642\", \"83639\", \"83481\", \"83481\", \"83482\", \"83…\n## $ methods         <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n## $ sources         <list> [<>, <\"Municipalidad de San José\", \"Instituto N…\n## $ total_revisions <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n## $ frequency       <chr> \"\", \"ondemand\", \"\", \"\", \"\", \"ondemand\", \"ondeman…\n## $ link            <chr> \"http://datosabiertos.msj.go.cr/dataviews/250481…\n## $ user            <chr> \"sanjose\", \"sanjose\", \"sanjose\", \"sanjose\", \"Msj…\n## $ status_str      <lgl> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …\n## $ guid            <chr> \"CANTI-Y-TASA-DE-92062\", \"DENSI-DE-POBLA-POR-DIS…\n## $ category_name   <chr> \"Características Sociales\", \"Demografía\", \"Educa…\n```\n:::\n\n\nCada uno de los elementos que allí aparecen son distintas tablas que\npueden tener diferentes dimensiones (filas y columnas). Es como una\ndescripción de lo que trata cada tabla. Si queremos traer a nuestro\nentorno los datos de una tabla en específico tenemos que hacerlo con su\n**GUID**.\n\nDe toda la tabla que llamamos en el paso anterior, vamos a hacer una\nselección de dos columnas: título y el GUID\n\n\n::: {.cell}\n\n```{.r .cell-code}\nguid <- indice %>% \n  select(title, guid)\n\nglimpse(guid)\n\n## Observations: 257\n## Variables: 2\n## $ title <chr> \"Cantidad y Tasa de muertes violentas\", \"Densidad de Pobla…\n## $ guid  <chr> \"CANTI-Y-TASA-DE-92062\", \"DENSI-DE-POBLA-POR-DISTR\", \"DIST…\n```\n:::\n\n\n### Obtener las dimensiones de las tablas\n\nAhora bien, ya sabemos el título y el identificador de la tabla, pero\ntenemos que tener cuidado. Son muchas tablas y algunas pueden estar\nvacías, ser datos resumidos o con muy pocos datos que no nos servirían\nde nada.\n\nPor suerte el paquete **junr** tiene una función que nos muestra la\ndimensión de las tablas, lo cual nos da mayor información sobre las\ncaracterísticas que tiene.\n\nHay que aclarar que la municipalidad de San José tiene muchas tablas y\nsi usamos la función para obtener las dimensiones se puede demorar sus\nminutos.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Por la cantidad de tablas que hay, esta funcion se demora mucho\ndimensiones <- get_dimensions(base_url = url_base, api_key = api_key)\n\n# Mostrar primeras seis observaciones\nhead(dimensiones)\n\n##                          GUID NROW NCOL DIM\n## 2       CANTI-Y-TASA-DE-92062    6   10  60\n## 21   DENSI-DE-POBLA-POR-DISTR   15   12 180\n## 3  DISTR-RELAT-DE-ESTUD-MATRI   12   10 120\n## 4  DISTR-DE-ESTUD-MATRI-77173   12   10 120\n## 5        POA-PRESU-ORDIN-2018  119    3 357\n## 6     INVER-EN-COLON-EN-43060    7    6  42\n```\n:::\n\n\n#### Cuadro con características de las tablas de la muni de SJ\n\nYa que tenemos las dimensiones de las tablas, podemos acomodar la\ninformación que hemos extraido hasta el momento de tal manera que\ntengamos un cuadro final con la información importante resumida: el\ntítulo de la tabla, el GUID y las dimensiones.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Unir el titulo a dimensiones\ndimensiones <- left_join(dimensiones, guid, by = c(\"GUID\" = \"guid\"))\n\n# Ordenar tablas con mayores dimensiones\ndim_ordenado <- dimensiones %>%\n  arrange(desc(DIM))\n\n# Revisar primeras entradas\nhead(dim_ordenado)\n\n##                         GUID NROW NCOL DIM\n## 1          ASIST-EDUCA-SUPER  108    9 972\n## 2                DEFUN-28990   64   13 832\n## 3                DEFUN-43464   64   13 832\n## 4                NACIM-43692   64   13 832\n## 5 DISTR-DE-POBLA-OCUPA-56023   52   11 572\n## 6 DISTR-DE-POBLA-OCUPA-36314   52   11 572\n##                                                                title\n## 1                                      Asistencia Educación Superior\n## 2                                                        Defunciones\n## 3                                                        Defunciones\n## 4                                                        Nacimientos\n## 5 Distribución de población ocupada por Grupo Ocupacional (Relativo)\n## 6            Distribución de población ocupada por Grupo Ocupacional\n```\n:::\n\n\n### Llamar datos de una tabla específica:\n\nYa con esto podemos hacer una mejor selección de las tablas que nos\nserían útiles. Cuando ya tengamos identificada una tabla tenemos que\nanotar su GUID que utilizaremos en la función:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Anotar en un objeto el GUID de la tabla que nos interesa\nguid_tabla <- \"ASIST-EDUCA-SUPER\"\n\n# Llamar la tabla. Usamos las mismas credenciales que habíamos usado\nasist_educacion <- get_data(base_url = url_base, api_key = SU_API_KEY, \n                            guid = guid_tabla)\n```\n:::\n\n\n¡Listo! Ya tenemos nuestra tabla de interés con los datos. Vamos a\nrevisarla\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(asist_educacion)\n\n##   Distrito   Sexo Tenencia de título Parauniversitaria Universitaria Total\n## 2 San José Hombre                 Sí              1951         24058 26009\n## 3 San José Hombre                 No               653          3498  4151\n## 4 San José Hombre              Total              2604         27556 30160\n## 5 San José  Mujer                 Sí              2599         26085 28684\n## 6 San José  Mujer                 No               924          4092  5016\n## 7 San José  Mujer              Total              3523         30177 33700\n##   Población de 17 años y más\n## 2                           \n## 3                           \n## 4                     100238\n## 5                           \n## 6                           \n## 7                     116461\n##   Porcentaje de población con educación superior\n## 2                                               \n## 3                                               \n## 4                                           30.1\n## 5                                               \n## 6                                               \n## 7                                           28.9\n##   Porcentaje de población con educación superior y título\n## 2                                                        \n## 3                                                        \n## 4                                                    86.2\n## 5                                                        \n## 6                                                        \n## 7                                                    85.1\n\nglimpse(asist_educacion)\n\n## Observations: 108\n## Variables: 9\n## $ Distrito                                                  <fct> San Jo…\n## $ Sexo                                                      <fct> Hombre…\n## $ `Tenencia de título`                                      <fct> Sí, No…\n## $ Parauniversitaria                                         <fct> 1951, …\n## $ Universitaria                                             <fct> 24058,…\n## $ Total                                                     <fct> 26009,…\n## $ `Población de 17 años y más`                              <fct> , , 10…\n## $ `Porcentaje de población con educación superior`          <fct> , , 30…\n## $ `Porcentaje de población con educación superior y título` <fct> , , 86…\n```\n:::\n\n\n\nReferencias\n-----------\n\n-   [vignette del paquete\n    junr](https://cran.r-project.org/web/packages/junr/vignettes/acceder-junar-api.html)\n-   [Página desarrolladores Municipalidad de San\n    José](http://datosabiertos.msj.go.cr/developers/)\n-   [Gobierno abierto Costa Rica](http://www.gobiernoabierto.go.cr/)\n\n## ¿Querés revisar más información?\n\nMi compañero [Erick Calderón](https://github.com/ecamo19) y yo estamos trabajando en un proyecto donde pretendemos crear más tutoriales sobre uso de datos abiertos del gobierno de Costa Rica a través de API's y el lenguaje de programación R. Si querés contribuir, tenés preguntas o una idea podés revisar [nuestro proyecto en Github](https://github.com/datos-abiertos-cr)\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}